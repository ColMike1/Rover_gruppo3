<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Progetto_Board1: C:/Users/Sterm/Documents/GitHub/Rover_gruppo3/Codice_Rover/Progetto_Board1/Core/Src/encoder/encoder_step.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Progetto_Board1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('encoder__step_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">encoder_step.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="encoder_8h_source.html">encoder/encoder.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="encoder__snapshot_8h_source.html">snapshot/encoder_snapshot.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="supervisor__snapshot_8h_source.html">snapshot/supervisor_snapshot.h</a>&quot;</code><br />
<code>#include &quot;cmsis_os2.h&quot;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;<a class="el" href="tim_8h_source.html">tim.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for encoder_step.c:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c__incl.png" border="0" usemap="#a_c_1_2_users_2_sterm_2_documents_2_git_hub_2_rover__gruppo3_2_codice___rover_2_progetto___board1_2_core_2_src_2encoder_2encoder__step_8c" loading="lazy" alt=""/></div>
<map name="a_c_1_2_users_2_sterm_2_documents_2_git_hub_2_rover__gruppo3_2_codice___rover_2_progetto___board1_2_core_2_src_2encoder_2encoder__step_8c" id="a_c_1_2_users_2_sterm_2_documents_2_git_hub_2_rover__gruppo3_2_codice___rover_2_progetto___board1_2_core_2_src_2encoder_2encoder__step_8c">
<area shape="rect" title=" " alt="" coords="479,5,683,80"/>
<area shape="rect" href="encoder_8h.html" title="Header principale per il modulo encoder." alt="" coords="186,136,314,163"/>
<area shape="poly" title=" " alt="" coords="477,78,306,133,304,128,481,75"/>
<area shape="rect" href="encoder__snapshot_8h.html" title="Buffer protetto per i dati letti dagli encoder." alt="" coords="389,136,584,163"/>
<area shape="poly" title=" " alt="" coords="550,79,510,126,506,122,546,82"/>
<area shape="rect" title=" " alt="" coords="365,227,440,253"/>
<area shape="poly" title=" " alt="" coords="477,62,451,74,424,88,399,107,379,129,372,149,373,171,379,192,389,214,384,212,374,194,368,172,367,148,375,127,395,103,421,84,449,69,481,60"/>
<area shape="rect" href="supervisor__snapshot_8h.html" title="Buffer protetto per le decisioni prese dal Supervisore di Board 1." alt="" coords="608,128,746,171"/>
<area shape="poly" title=" " alt="" coords="615,78,651,117,645,116,614,83"/>
<area shape="rect" title=" " alt="" coords="771,136,866,163"/>
<area shape="poly" title=" " alt="" coords="665,78,778,129,773,129,664,83"/>
<area shape="rect" href="tim_8h.html" title="This file contains all the function prototypes for the tim.c file." alt="" coords="981,136,1032,163"/>
<area shape="poly" title=" " alt="" coords="683,66,969,138,964,139,683,72"/>
<area shape="rect" href="encoder__step_8h.html" title="Gestione dell&#39;elaborazione periodica dei dati encoder." alt="" coords="181,227,341,253"/>
<area shape="poly" title=" " alt="" coords="253,161,260,212,255,210,250,166"/>
<area shape="rect" href="encoder__hw_8h.html" title="Driver di basso livello per l&#39;interfacciamento con gli encoder hardware." alt="" coords="5,227,157,253"/>
<area shape="poly" title=" " alt="" coords="225,165,120,221,117,217,228,161"/>
<area shape="rect" title=" " alt="" coords="445,309,509,336"/>
<area shape="poly" title=" " alt="" coords="135,251,170,259,431,310,428,315,168,264,136,257"/>
<area shape="poly" title=" " alt="" coords="488,161,481,295,476,292,484,165"/>
<area shape="poly" title=" " alt="" coords="477,162,426,217,423,213,472,165"/>
<area shape="rect" title=" " alt="" coords="514,227,602,253"/>
<area shape="poly" title=" " alt="" coords="498,161,541,215,536,214,496,166"/>
<area shape="poly" title=" " alt="" coords="672,170,651,217,636,242,616,263,572,293,525,312,524,306,569,288,613,259,631,238,647,215,668,173"/>
<area shape="poly" title=" " alt="" coords="615,171,455,224,454,219,610,172"/>
<area shape="poly" title=" " alt="" coords="652,170,588,220,586,215,647,172"/>
<area shape="rect" title=" " alt="" coords="678,219,834,261"/>
<area shape="poly" title=" " alt="" coords="696,169,730,208,725,206,694,174"/>
<area shape="rect" title=" " alt="" coords="858,219,1035,261"/>
<area shape="poly" title=" " alt="" coords="740,169,872,213,866,213,740,174"/>
<area shape="rect" href="main_8h.html" title=": Header for main.c file. This file contains the common defines of the application." alt="" coords="1059,227,1119,253"/>
<area shape="poly" title=" " alt="" coords="1019,161,1069,216,1064,214,1017,166"/>
<area shape="rect" title=" " alt="" coords="1029,309,1149,336"/>
<area shape="poly" title=" " alt="" coords="1091,252,1091,296,1087,292,1087,256"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0b82c67a65f9271c9624c2783dac10f6" id="r_a0b82c67a65f9271c9624c2783dac10f6"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a0b82c67a65f9271c9624c2783dac10f6">ENCODER_TASK_PERIOD_S</a>&#160;&#160;&#160;0.01f</td></tr>
<tr class="memitem:ae929ca78c731b77fe6f5bb516d9a9cfc" id="r_ae929ca78c731b77fe6f5bb516d9a9cfc"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#ae929ca78c731b77fe6f5bb516d9a9cfc">NUM_ENCODERS</a>&#160;&#160;&#160;4U</td></tr>
<tr class="memitem:adde42fcc3c8f7e4e7d22b06b681b456d" id="r_adde42fcc3c8f7e4e7d22b06b681b456d"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#adde42fcc3c8f7e4e7d22b06b681b456d">TICKS_PER_REV</a>&#160;&#160;&#160;2448.0f</td></tr>
<tr class="memitem:a0a190c6f1b10c5b6ea48e786dec7a939" id="r_a0a190c6f1b10c5b6ea48e786dec7a939"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a0a190c6f1b10c5b6ea48e786dec7a939">RPM_EPS</a>&#160;&#160;&#160;2.5f</td></tr>
<tr class="memdesc:a0a190c6f1b10c5b6ea48e786dec7a939"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tolleranza per considerare la ruota ferma [RPM].  <br /></td></tr>
<tr class="memitem:aa0fb76736b347d57f09601094b72d092" id="r_aa0fb76736b347d57f09601094b72d092"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#aa0fb76736b347d57f09601094b72d092">U_TRIG</a>&#160;&#160;&#160;2.0f</td></tr>
<tr class="memdesc:aa0fb76736b347d57f09601094b72d092"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tensione minima di attivazione per il controllo di stallo [V].  <br /></td></tr>
<tr class="memitem:a265e05e39334c60af30816a55ea6ee41" id="r_a265e05e39334c60af30816a55ea6ee41"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a265e05e39334c60af30816a55ea6ee41">N_FAIL</a>&#160;&#160;&#160;20U</td></tr>
<tr class="memdesc:a265e05e39334c60af30816a55ea6ee41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Numero di cicli consecutivi di errore per dichiarare il guasto feedback.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a490b7782c5a8e9a1850f12d956e23d93" id="r_a490b7782c5a8e9a1850f12d956e23d93"><td class="memItemLeft">static float&#160;</td><td class="memItemRight"><a class="el" href="#a490b7782c5a8e9a1850f12d956e23d93">DeltaTicks_ToRPM</a> (int delta_ticks)</td></tr>
<tr class="memdesc:a490b7782c5a8e9a1850f12d956e23d93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converte i ticks misurati in velocità angolare (RPM).  <br /></td></tr>
<tr class="memitem:a42c392c4a6f5170fd61c36a38486549c" id="r_a42c392c4a6f5170fd61c36a38486549c"><td class="memItemLeft">static float&#160;</td><td class="memItemRight"><a class="el" href="#a42c392c4a6f5170fd61c36a38486549c">abs_f32</a> (float x)</td></tr>
<tr class="memdesc:a42c392c4a6f5170fd61c36a38486549c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcola il valore assoluto di un float.  <br /></td></tr>
<tr class="memitem:a1c8318d644fc2e61cc1ef9cb0710feb6" id="r_a1c8318d644fc2e61cc1ef9cb0710feb6"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a1c8318d644fc2e61cc1ef9cb0710feb6">Encoder_Init</a> (void)</td></tr>
<tr class="memdesc:a1c8318d644fc2e61cc1ef9cb0710feb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Avvia l'interfaccia encoder dei timer hardware.  <br /></td></tr>
<tr class="memitem:ae00e575d81dcde5b0d92b0d4cdee7255" id="r_ae00e575d81dcde5b0d92b0d4cdee7255"><td class="memItemLeft">static bool&#160;</td><td class="memItemRight"><a class="el" href="#ae00e575d81dcde5b0d92b0d4cdee7255">Encoder_hasNoFeedback</a> (uint8_t idx, float u_cmd, float rpm)</td></tr>
<tr class="memdesc:ae00e575d81dcde5b0d92b0d4cdee7255"><td class="mdescLeft">&#160;</td><td class="mdescRight">Diagnostica la presenza di feedback dall'encoder.  <br /></td></tr>
<tr class="memitem:a6d29812c0974c1693e1fd4aa1c187c39" id="r_a6d29812c0974c1693e1fd4aa1c187c39"><td class="memItemLeft">static void&#160;</td><td class="memItemRight"><a class="el" href="#a6d29812c0974c1693e1fd4aa1c187c39">Apply_Encoders_Fallback</a> (<a class="el" href="struct_encoder_snapshot__t.html">EncoderSnapshot_t</a> *const snap, const <a class="el" href="struct_supervisor_snapshot__t.html">SupervisorSnapshot_t</a> sup)</td></tr>
<tr class="memdesc:a6d29812c0974c1693e1fd4aa1c187c39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logica di fallback per la stima dei giri ruota in caso di guasto ai sensori.  <br /></td></tr>
<tr class="memitem:a620bc6b8cb569dc4ffbb6980aad07821" id="r_a620bc6b8cb569dc4ffbb6980aad07821"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a620bc6b8cb569dc4ffbb6980aad07821">Encoder_Step</a> (float last_cycle_cmd[4])</td></tr>
<tr class="memdesc:a620bc6b8cb569dc4ffbb6980aad07821"><td class="mdescLeft">&#160;</td><td class="mdescRight">Step periodico del task encoder.  <br /></td></tr>
</table>
<a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="a0b82c67a65f9271c9624c2783dac10f6" name="a0b82c67a65f9271c9624c2783dac10f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b82c67a65f9271c9624c2783dac10f6">&#9670;&#160;</a></span>ENCODER_TASK_PERIOD_S</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ENCODER_TASK_PERIOD_S&#160;&#160;&#160;0.01f</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a265e05e39334c60af30816a55ea6ee41" name="a265e05e39334c60af30816a55ea6ee41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a265e05e39334c60af30816a55ea6ee41">&#9670;&#160;</a></span>N_FAIL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define N_FAIL&#160;&#160;&#160;20U</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Numero di cicli consecutivi di errore per dichiarare il guasto feedback. </p>

</div>
</div>
<a id="ae929ca78c731b77fe6f5bb516d9a9cfc" name="ae929ca78c731b77fe6f5bb516d9a9cfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae929ca78c731b77fe6f5bb516d9a9cfc">&#9670;&#160;</a></span>NUM_ENCODERS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_ENCODERS&#160;&#160;&#160;4U</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0a190c6f1b10c5b6ea48e786dec7a939" name="a0a190c6f1b10c5b6ea48e786dec7a939"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a190c6f1b10c5b6ea48e786dec7a939">&#9670;&#160;</a></span>RPM_EPS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RPM_EPS&#160;&#160;&#160;2.5f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tolleranza per considerare la ruota ferma [RPM]. </p>

</div>
</div>
<a id="adde42fcc3c8f7e4e7d22b06b681b456d" name="adde42fcc3c8f7e4e7d22b06b681b456d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adde42fcc3c8f7e4e7d22b06b681b456d">&#9670;&#160;</a></span>TICKS_PER_REV</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TICKS_PER_REV&#160;&#160;&#160;2448.0f</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa0fb76736b347d57f09601094b72d092" name="aa0fb76736b347d57f09601094b72d092"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0fb76736b347d57f09601094b72d092">&#9670;&#160;</a></span>U_TRIG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define U_TRIG&#160;&#160;&#160;2.0f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tensione minima di attivazione per il controllo di stallo [V]. </p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a42c392c4a6f5170fd61c36a38486549c" name="a42c392c4a6f5170fd61c36a38486549c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42c392c4a6f5170fd61c36a38486549c">&#9670;&#160;</a></span>abs_f32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float abs_f32 </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>x</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calcola il valore assoluto di un float. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>Valore in ingresso. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>float Valore assoluto. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_a42c392c4a6f5170fd61c36a38486549c_icgraph.png" border="0" usemap="#aencoder__step_8c_a42c392c4a6f5170fd61c36a38486549c_icgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_a42c392c4a6f5170fd61c36a38486549c_icgraph" id="aencoder__step_8c_a42c392c4a6f5170fd61c36a38486549c_icgraph">
<area shape="rect" title="Calcola il valore assoluto di un float." alt="" coords="841,5,908,32"/>
<area shape="rect" href="encoder__step_8c.html#ae00e575d81dcde5b0d92b0d4cdee7255" title="Diagnostica la presenza di feedback dall&#39;encoder." alt="" coords="622,5,793,32"/>
<area shape="poly" title=" " alt="" coords="823,19,793,21,793,16,828,19"/>
<area shape="rect" href="encoder__step_8c.html#a620bc6b8cb569dc4ffbb6980aad07821" title="Esegue il campionamento degli encoder e converte i tick in unità fisiche." alt="" coords="470,5,574,32"/>
<area shape="poly" title=" " alt="" coords="603,19,574,21,574,16,609,19"/>
<area shape="rect" href="app__freertos_8c.html#a8decb0ed70f1b4d12a7abbdbcdf8d18f" title="Task di Controllo Motori e Attuazione." alt="" coords="296,5,422,32"/>
<area shape="poly" title=" " alt="" coords="452,19,423,21,423,16,457,19"/>
<area shape="rect" href="app__freertos_8c.html#abade755e13d07c10889ae83143656158" title="Inizializzazione di FreeRTOS." alt="" coords="103,5,248,32"/>
<area shape="poly" title=" " alt="" coords="278,19,249,21,248,16,283,19"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a6d29812c0974c1693e1fd4aa1c187c39" name="a6d29812c0974c1693e1fd4aa1c187c39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d29812c0974c1693e1fd4aa1c187c39">&#9670;&#160;</a></span>Apply_Encoders_Fallback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Apply_Encoders_Fallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_encoder_snapshot__t.html">EncoderSnapshot_t</a> *const</td>          <td class="paramname"><span class="paramname"><em>snap</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_supervisor_snapshot__t.html">SupervisorSnapshot_t</a></td>          <td class="paramname"><span class="paramname"><em>sup</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Logica di fallback per la stima dei giri ruota in caso di guasto ai sensori. </p>
<p>Se uno o più encoder falliscono, i giri mancanti vengono stimati basandosi sulle letture delle ruote sane (stesso lato, stesso asse o incrociate). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">snap</td><td>Snapshot degli encoder da correggere. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sup</td><td>Snapshot del supervisore per conoscere lo stato dei guasti. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_a6d29812c0974c1693e1fd4aa1c187c39_icgraph.png" border="0" usemap="#aencoder__step_8c_a6d29812c0974c1693e1fd4aa1c187c39_icgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_a6d29812c0974c1693e1fd4aa1c187c39_icgraph" id="aencoder__step_8c_a6d29812c0974c1693e1fd4aa1c187c39_icgraph">
<area shape="rect" title="Logica di fallback per la stima dei giri ruota in caso di guasto ai sensori." alt="" coords="622,5,794,32"/>
<area shape="rect" href="encoder__step_8c.html#a620bc6b8cb569dc4ffbb6980aad07821" title="Esegue il campionamento degli encoder e converte i tick in unità fisiche." alt="" coords="470,5,574,32"/>
<area shape="poly" title=" " alt="" coords="603,19,574,21,574,16,609,19"/>
<area shape="rect" href="app__freertos_8c.html#a8decb0ed70f1b4d12a7abbdbcdf8d18f" title="Task di Controllo Motori e Attuazione." alt="" coords="296,5,422,32"/>
<area shape="poly" title=" " alt="" coords="452,19,423,21,423,16,457,19"/>
<area shape="rect" href="app__freertos_8c.html#abade755e13d07c10889ae83143656158" title="Inizializzazione di FreeRTOS." alt="" coords="103,5,248,32"/>
<area shape="poly" title=" " alt="" coords="278,19,249,21,248,16,283,19"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a490b7782c5a8e9a1850f12d956e23d93" name="a490b7782c5a8e9a1850f12d956e23d93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a490b7782c5a8e9a1850f12d956e23d93">&#9670;&#160;</a></span>DeltaTicks_ToRPM()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float DeltaTicks_ToRPM </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>delta_ticks</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Converte i ticks misurati in velocità angolare (RPM). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">delta_ticks</td><td>Variazione dei ticks nel periodo. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>float Velocità calcolata in RPM. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_a490b7782c5a8e9a1850f12d956e23d93_icgraph.png" border="0" usemap="#aencoder__step_8c_a490b7782c5a8e9a1850f12d956e23d93_icgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_a490b7782c5a8e9a1850f12d956e23d93_icgraph" id="aencoder__step_8c_a490b7782c5a8e9a1850f12d956e23d93_icgraph">
<area shape="rect" title="Converte i ticks misurati in velocità angolare (RPM)." alt="" coords="622,5,757,32"/>
<area shape="rect" href="encoder__step_8c.html#a620bc6b8cb569dc4ffbb6980aad07821" title="Esegue il campionamento degli encoder e converte i tick in unità fisiche." alt="" coords="470,5,574,32"/>
<area shape="poly" title=" " alt="" coords="603,19,574,21,574,16,608,19"/>
<area shape="rect" href="app__freertos_8c.html#a8decb0ed70f1b4d12a7abbdbcdf8d18f" title="Task di Controllo Motori e Attuazione." alt="" coords="296,5,422,32"/>
<area shape="poly" title=" " alt="" coords="452,19,423,21,423,16,457,19"/>
<area shape="rect" href="app__freertos_8c.html#abade755e13d07c10889ae83143656158" title="Inizializzazione di FreeRTOS." alt="" coords="103,5,248,32"/>
<area shape="poly" title=" " alt="" coords="278,19,249,21,248,16,283,19"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="ae00e575d81dcde5b0d92b0d4cdee7255" name="ae00e575d81dcde5b0d92b0d4cdee7255"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae00e575d81dcde5b0d92b0d4cdee7255">&#9670;&#160;</a></span>Encoder_hasNoFeedback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Encoder_hasNoFeedback </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>idx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>u_cmd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>rpm</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Diagnostica la presenza di feedback dall'encoder. </p>
<p>Implementa un contatore di stallo: se la tensione di comando è alta ma i giri letti sono quasi nulli per N_FAIL cicli, viene segnalato un guasto. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idx</td><td>Indice dell'encoder. </td></tr>
    <tr><td class="paramname">u_cmd</td><td>Comando di tensione inviato nell'ultimo ciclo. </td></tr>
    <tr><td class="paramname">rpm</td><td>Velocità misurata. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true Se è stato rilevato un guasto o uno stallo persistente. </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_cgraph.png" border="0" usemap="#aencoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_cgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_cgraph" id="aencoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_cgraph">
<area shape="rect" title="Diagnostica la presenza di feedback dall&#39;encoder." alt="" coords="5,5,177,32"/>
<area shape="rect" href="encoder__step_8c.html#a42c392c4a6f5170fd61c36a38486549c" title="Calcola il valore assoluto di un float." alt="" coords="225,5,292,32"/>
<area shape="poly" title=" " alt="" coords="177,16,212,19,206,19,177,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_icgraph.png" border="0" usemap="#aencoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_icgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_icgraph" id="aencoder__step_8c_ae00e575d81dcde5b0d92b0d4cdee7255_icgraph">
<area shape="rect" title="Diagnostica la presenza di feedback dall&#39;encoder." alt="" coords="622,5,793,32"/>
<area shape="rect" href="encoder__step_8c.html#a620bc6b8cb569dc4ffbb6980aad07821" title="Esegue il campionamento degli encoder e converte i tick in unità fisiche." alt="" coords="470,5,574,32"/>
<area shape="poly" title=" " alt="" coords="603,19,574,21,574,16,609,19"/>
<area shape="rect" href="app__freertos_8c.html#a8decb0ed70f1b4d12a7abbdbcdf8d18f" title="Task di Controllo Motori e Attuazione." alt="" coords="296,5,422,32"/>
<area shape="poly" title=" " alt="" coords="452,19,423,21,423,16,457,19"/>
<area shape="rect" href="app__freertos_8c.html#abade755e13d07c10889ae83143656158" title="Inizializzazione di FreeRTOS." alt="" coords="103,5,248,32"/>
<area shape="poly" title=" " alt="" coords="278,19,249,21,248,16,283,19"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a1c8318d644fc2e61cc1ef9cb0710feb6" name="a1c8318d644fc2e61cc1ef9cb0710feb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c8318d644fc2e61cc1ef9cb0710feb6">&#9670;&#160;</a></span>Encoder_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Encoder_Init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Avvia l'interfaccia encoder dei timer hardware. </p>
<p>Inizializza i timer e le periferiche dedicate agli encoder. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_a1c8318d644fc2e61cc1ef9cb0710feb6_icgraph.png" border="0" usemap="#aencoder__step_8c_a1c8318d644fc2e61cc1ef9cb0710feb6_icgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_a1c8318d644fc2e61cc1ef9cb0710feb6_icgraph" id="aencoder__step_8c_a1c8318d644fc2e61cc1ef9cb0710feb6_icgraph">
<area shape="rect" title="Avvia l&#39;interfaccia encoder dei timer hardware." alt="" coords="470,5,565,32"/>
<area shape="rect" href="app__freertos_8c.html#a8decb0ed70f1b4d12a7abbdbcdf8d18f" title="Task di Controllo Motori e Attuazione." alt="" coords="296,5,422,32"/>
<area shape="poly" title=" " alt="" coords="452,19,422,21,422,16,457,19"/>
<area shape="rect" href="app__freertos_8c.html#abade755e13d07c10889ae83143656158" title="Inizializzazione di FreeRTOS." alt="" coords="103,5,248,32"/>
<area shape="poly" title=" " alt="" coords="278,19,249,21,248,16,283,19"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a620bc6b8cb569dc4ffbb6980aad07821" name="a620bc6b8cb569dc4ffbb6980aad07821"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a620bc6b8cb569dc4ffbb6980aad07821">&#9670;&#160;</a></span>Encoder_Step()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Encoder_Step </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>last_cycle_cmd</em></span>[4]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Step periodico del task encoder. </p>
<p>Esegue il campionamento degli encoder e converte i tick in unità fisiche.</p>
<ol type="1">
<li>Legge i delta ticks hardware per i 4 motori.</li>
<li>Converte i dati in RPM e aggiorna i timestamp.</li>
<li>Esegue la diagnostica dello stallo basata sul comando del ciclo precedente.</li>
<li>Se necessario, applica le correzioni di fallback.</li>
<li>Scrive lo snapshot finale per gli altri task. <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">last_cycle_cmd</td><td>Array dei comandi di tensione [V] applicati nell'ultima iterazione. </td></tr>
  </table>
  </dd>
</dl>
</li>
</ol>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_cgraph.png" border="0" usemap="#aencoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_cgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_cgraph" id="aencoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_cgraph">
<area shape="rect" title="Step periodico del task encoder." alt="" coords="5,132,109,159"/>
<area shape="rect" href="encoder__step_8c.html#a6d29812c0974c1693e1fd4aa1c187c39" title="Logica di fallback per la stima dei giri ruota in caso di guasto ai sensori." alt="" coords="159,5,331,32"/>
<area shape="poly" title=" " alt="" coords="66,130,102,87,127,62,155,42,169,37,165,40,158,46,130,67,106,90,70,133"/>
<area shape="rect" href="encoder__step_8c.html#a490b7782c5a8e9a1850f12d956e23d93" title="Converte i ticks misurati in velocità angolare (RPM)." alt="" coords="177,56,312,83"/>
<area shape="poly" title=" " alt="" coords="80,129,156,92,178,86,173,89,158,97,84,134"/>
<area shape="rect" href="encoder__step_8c.html#ae00e575d81dcde5b0d92b0d4cdee7255" title="Diagnostica la presenza di feedback dall&#39;encoder." alt="" coords="159,107,330,133"/>
<area shape="poly" title=" " alt="" coords="108,136,146,132,141,135,110,141"/>
<area shape="rect" href="encoder__hw_8c.html#ae734ba8b992135e178c9347f230763cb" title="Legge la variazione di tick (delta) con gestione dell&#39;overflow." alt="" coords="176,157,314,184"/>
<area shape="poly" title=" " alt="" coords="108,150,162,158,158,161,109,155"/>
<area shape="rect" href="encoder__snapshot_8c.html#a461cb0565d6741f020ebd4aae43fc68b" title="Scrive i dati degli encoder nello snapshot." alt="" coords="164,208,326,235"/>
<area shape="poly" title=" " alt="" coords="82,157,158,194,178,203,173,203,156,198,82,162"/>
<area shape="rect" href="supervisor__snapshot_8c.html#a86490218ec807bc7b449e09eb268b4e4" title="Legge le decisioni del supervisore (usato da Controllo, Attuazione, TX)." alt="" coords="157,259,333,285"/>
<area shape="poly" title=" " alt="" coords="69,156,106,200,130,224,158,244,170,252,164,252,155,249,127,228,102,204,67,162"/>
<area shape="rect" href="encoder__step_8c.html#a42c392c4a6f5170fd61c36a38486549c" title="Calcola il valore assoluto di un float." alt="" coords="381,107,448,133"/>
<area shape="poly" title=" " alt="" coords="330,117,368,119,363,121,331,123"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="encoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_icgraph.png" border="0" usemap="#aencoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_icgraph" loading="lazy" alt=""/></div>
<map name="aencoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_icgraph" id="aencoder__step_8c_a620bc6b8cb569dc4ffbb6980aad07821_icgraph">
<area shape="rect" title="Step periodico del task encoder." alt="" coords="470,5,574,32"/>
<area shape="rect" href="app__freertos_8c.html#a8decb0ed70f1b4d12a7abbdbcdf8d18f" title="Task di Controllo Motori e Attuazione." alt="" coords="296,5,422,32"/>
<area shape="poly" title=" " alt="" coords="452,19,423,21,423,16,457,19"/>
<area shape="rect" href="app__freertos_8c.html#abade755e13d07c10889ae83143656158" title="Inizializzazione di FreeRTOS." alt="" coords="103,5,248,32"/>
<area shape="poly" title=" " alt="" coords="278,19,249,21,248,16,283,19"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_ba1ad0f6fefb469be70fa30f352bf580.html">Codice_Rover</a></li><li class="navelem"><a href="dir_7222b17cb0a748b5177d9b53a2c0d926.html">Progetto_Board1</a></li><li class="navelem"><a href="dir_5def2043098f83d89c5dc9dfb3b311d5.html">Core</a></li><li class="navelem"><a href="dir_5b1e438574ac498c6e11c94f1f56d9f4.html">Src</a></li><li class="navelem"><a href="dir_6ad904b71fda58323952082395be56b2.html">encoder</a></li><li class="navelem"><a href="encoder__step_8c.html">encoder_step.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
