/*
 * Academic License - for use in teaching, academic research, and meeting
 * course requirements at degree granting institutions only.  Not for
 * government, commercial, or other organizational use.
 *
 * File: SupervisorB2.c
 *
 * Code generated for Simulink model 'SupervisorB2'.
 *
 * Model version                  : 1.168
 * Simulink Coder version         : 24.2 (R2024b) 21-Jun-2024
 * C/C++ source code generated on : Wed Feb 11 19:07:21 2026
 *
 * Target selection: ert.tlc
 * Embedded hardware selection: Intel->x86-64 (Windows64)
 * Code generation objectives: Unspecified
 * Validation result: Not run
 */

#include "SupervisorB2.h"
#include "rtwtypes.h"
#include "shared_resources/supervisor_command.h"
#include "SupervisorB2_types.h"
#include <math.h>
#include "rt_nonfinite.h"
#include "shared_resources\imu_coherence_status.h"
#include <string.h>
#include "SupervisorB2_private.h"

/* Named constants for Chart: '<Root>/B1_Failure_Fallback' */
#define Supervi_IN_B2_trying_to_actuate ((uint8_T)2U)
#define SupervisorB2_IN_B1_actuating   ((uint8_T)1U)
#define SupervisorB2_IN_NO_ACTIVE_CHILD ((uint8_T)0U)

/* Named constants for Chart: '<S9>/SuperB2_DEGB1_0' */
#define IN_check_sonars_for_moving_agai ((uint8_T)1U)
#define Su_IN_check_sonars_for_stopping ((uint8_T)2U)
#define SupervisorB2_IN_AvoidS1        ((uint8_T)1U)
#define SupervisorB2_IN_AvoidS3        ((uint8_T)2U)
#define SupervisorB2_IN_Fall1Detected  ((uint8_T)1U)
#define SupervisorB2_IN_InEmergency    ((uint8_T)3U)
#define SupervisorB2_IN_MoveToS1       ((uint8_T)4U)
#define SupervisorB2_IN_MoveToS3       ((uint8_T)5U)
#define SupervisorB2_IN_WS1            ((uint8_T)1U)
#define SupervisorB2_IN_WS2            ((uint8_T)1U)
#define SupervisorB2_IN_WS3            ((uint8_T)1U)
#define SupervisorB2_IN_Waiting        ((uint8_T)6U)
#define SupervisorB2_IN_Waiting_i      ((uint8_T)2U)
#define SupervisorB2_event_Fall1       (145)
#define SupervisorB2_event_Fall2       (146)
#define SupervisorB2_event_Fall3       (147)
#define SupervisorB2_event_avoidS1     (174)
#define SupervisorB2_event_avoidS3     (175)
#define SupervisorB2_event_emergency   (148)
#define SupervisorB2_event_moveToS1    (149)
#define SupervisorB2_event_moveToS3    (151)
#define SupervisorB2_event_safe        (152)

/* Named constants for Chart: '<S5>/Check rover safety state' */
#define Supervi_IN_Rover_Critical_State ((uint8_T)1U)
#define Supervi_IN_Rover_Degraded_State ((uint8_T)2U)

/* Named constants for Chart: '<S5>/Check rover safety state1' */
#define IN_Procedura_frenata_di_emergen ((uint8_T)1U)
#define Supe_IN_In_frenata_di_emergenza ((uint8_T)1U)
#define Superviso_IN_Stato_Marcia_rover ((uint8_T)2U)
#define SupervisorB2_IN_Motori_fermi   ((uint8_T)2U)
#define SupervisorB2_IN_Normale_marcia ((uint8_T)1U)
#define SupervisorB2_IN_Retromarcia_180 ((uint8_T)2U)

/* Named constants for Chart: '<Root>/Monitor Board Status1' */
#define SupervisorB2_IN_B1_sup_critical ((uint8_T)1U)
#define SupervisorB2_IN_B1_sup_degraded ((uint8_T)2U)
#define SupervisorB2_IN_B1_sup_ok      ((uint8_T)3U)
#define SupervisorB2_IN_ESP_critical   ((uint8_T)1U)
#define SupervisorB2_IN_ESP_degraded   ((uint8_T)2U)
#define SupervisorB2_IN_ESP_ok         ((uint8_T)3U)
#define SupervisorB2_IN_IMU_critical   ((uint8_T)1U)
#define SupervisorB2_IN_IMU_degraded   ((uint8_T)2U)
#define SupervisorB2_IN_IMU_ok         ((uint8_T)3U)
#define SupervisorB2_IN_Rx_critical    ((uint8_T)1U)
#define SupervisorB2_IN_Rx_degraded    ((uint8_T)2U)
#define SupervisorB2_IN_Rx_ok          ((uint8_T)3U)

/* Block signals (default storage) */
B_SupervisorB2_T SupervisorB2_B;

/* Block states (default storage) */
DW_SupervisorB2_T SupervisorB2_DW;

/* External inputs (root inport signals with default storage) */
ExtU_SupervisorB2_T SupervisorB2_U;

/* External outputs (root outports fed by signals with default storage) */
ExtY_SupervisorB2_T SupervisorB2_Y;

/* Real-time model */
static RT_MODEL_SupervisorB2_T SupervisorB2_M_;
RT_MODEL_SupervisorB2_T *const SupervisorB2_M = &SupervisorB2_M_;

/* Forward declaration for local functions */
static boolean_T SupervisorB2_gyroTargetDiff(real32_T gyro_angle, real32_T
  targetAngle);
static real32_T SupervisorB2_angleCalculator(real32_T gyro_angle,
  SupervisorCommand_t B2Decision);
static void SupervisorB2_B2Decisions(const real32_T *gyro_angle, const int32_T
  *sfEvent);
static uint8_T Supervisor_check_emergency_stop(const uint16_T sonars[3]);
static uint8_T SupervisorB2_closeRange(uint16_T sonar);
static void SupervisorB2_timers(const real32_T *gyro_angle, int32_T *sfEvent);
static boolean_T Supe_isCommDegradedByMeanPeriod(uint32_T data_last_valid_ms,
  real_T mean_threshold_ms);
static void SupervisorB2_MonitorRx(RxStatus *rx_status);
static uint8_T Supervis_check_emergency_stop_e(const uint16_T sonars[3]);
static void SupervisorB2_updateSafetyLimits(SafetyStatus rover_state, real_T
  *V_MAX, real_T *OMEGA_MAX);
static real32_T SupervisorB2_angleError(real32_T gyro_angle, real32_T
  targetAngle);
static real32_T SupervisorB2_angleCalculator180(real32_T gyro_angle);
static boolean_T SupervisorB2_checkStop(const real32_T wheel_speeds[4]);

/* Function for Chart: '<S9>/SuperB2_DEGB1_0' */
static boolean_T SupervisorB2_gyroTargetDiff(real32_T gyro_angle, real32_T
  targetAngle)
{
  real32_T x;
  x = (targetAngle - gyro_angle) + 180.0F;
  if (rtIsNaNF(x)) {
    x = (rtNaNF);
  } else if (rtIsInfF(x)) {
    x = (rtNaNF);
  } else if (x == 0.0F) {
    x = 0.0F;
  } else {
    x = fmodf(x, 360.0F);
    if (x == 0.0F) {
      x = 0.0F;
    } else if (x < 0.0F) {
      x += 360.0F;
    }
  }

  return fabsf(x - 180.0F) < 12.0F;
}

/* Function for Chart: '<S9>/SuperB2_DEGB1_0' */
static real32_T SupervisorB2_angleCalculator(real32_T gyro_angle,
  SupervisorCommand_t B2Decision)
{
  real32_T targetAngle;
  if ((int32_T)B2Decision == 2) {
    if (gyro_angle - 45.0F < 0.0F) {
      targetAngle = (gyro_angle - 45.0F) + 360.0F;
    } else {
      targetAngle = gyro_angle - 45.0F;
    }
  } else if (gyro_angle + 45.0F > 360.0F) {
    targetAngle = (gyro_angle + 45.0F) - 360.0F;
  } else {
    targetAngle = gyro_angle + 45.0F;
  }

  return targetAngle;
}

/* Function for Chart: '<S9>/SuperB2_DEGB1_0' */
static void SupervisorB2_B2Decisions(const real32_T *gyro_angle, const int32_T
  *sfEvent)
{
  switch (SupervisorB2_DW.is_B2Decisions) {
   case SupervisorB2_IN_AvoidS1:
    if (*sfEvent == SupervisorB2_event_emergency) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_InEmergency;
      SupervisorB2_B.B2Decision_c = CMD_ESTOP;
    } else if (SupervisorB2_DW.temporalCounter_i1_p >= 25) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_Waiting;
      SupervisorB2_B.B2Decision_c = CMD_NORMAL;
    }
    break;

   case SupervisorB2_IN_AvoidS3:
    if (*sfEvent == SupervisorB2_event_emergency) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_InEmergency;
      SupervisorB2_B.B2Decision_c = CMD_ESTOP;
    } else if (SupervisorB2_DW.temporalCounter_i1_p >= 25) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_Waiting;
      SupervisorB2_B.B2Decision_c = CMD_NORMAL;
    }
    break;

   case SupervisorB2_IN_InEmergency:
    if (*sfEvent == SupervisorB2_event_safe) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_Waiting;
      SupervisorB2_B.B2Decision_c = CMD_NORMAL;
    }
    break;

   case SupervisorB2_IN_MoveToS1:
    if (*sfEvent == SupervisorB2_event_emergency) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_InEmergency;
      SupervisorB2_B.B2Decision_c = CMD_ESTOP;
    } else if (SupervisorB2_gyroTargetDiff(*gyro_angle,
                SupervisorB2_DW.targetAngle_g)) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_Waiting;
      SupervisorB2_B.B2Decision_c = CMD_NORMAL;
    }
    break;

   case SupervisorB2_IN_MoveToS3:
    if (*sfEvent == SupervisorB2_event_emergency) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_InEmergency;
      SupervisorB2_B.B2Decision_c = CMD_ESTOP;
    } else if (SupervisorB2_gyroTargetDiff(*gyro_angle,
                SupervisorB2_DW.targetAngle_g)) {
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_Waiting;
      SupervisorB2_B.B2Decision_c = CMD_NORMAL;
    }
    break;

   case SupervisorB2_IN_Waiting:
    switch (*sfEvent) {
     case SupervisorB2_event_emergency:
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_InEmergency;
      SupervisorB2_B.B2Decision_c = CMD_ESTOP;
      break;

     case SupervisorB2_event_moveToS3:
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_MoveToS3;
      SupervisorB2_B.B2Decision_c = CMD_GO_RIGHT;
      SupervisorB2_DW.targetAngle_g = SupervisorB2_angleCalculator(*gyro_angle,
        CMD_GO_RIGHT);
      break;

     case SupervisorB2_event_avoidS3:
      SupervisorB2_DW.temporalCounter_i1_p = 0U;
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_AvoidS3;
      SupervisorB2_B.B2Decision_c = CMD_AVOID_RIGHT;
      break;

     case SupervisorB2_event_moveToS1:
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_MoveToS1;
      SupervisorB2_B.B2Decision_c = CMD_GO_LEFT;
      SupervisorB2_DW.targetAngle_g = SupervisorB2_angleCalculator(*gyro_angle,
        CMD_GO_LEFT);
      break;

     case SupervisorB2_event_avoidS1:
      SupervisorB2_DW.temporalCounter_i1_p = 0U;
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_AvoidS1;
      SupervisorB2_B.B2Decision_c = CMD_AVOID_LEFT;
      break;
    }
    break;
  }
}

/* Function for Chart: '<S9>/SuperB2_DEGB1_0' */
static uint8_T Supervisor_check_emergency_stop(const uint16_T sonars[3])
{

  uint8_T stop;
  if (sonars[0] <= 70) {
    stop = 1U;
  } else if (sonars[1] <= 70) {
    stop = 1U;
  } else {
    stop = (uint8_T)(sonars[2] <= 70);
  }
  printf("stop: %u\r\n", stop);
  return stop;
}

/* Function for Chart: '<S9>/SuperB2_DEGB1_0' */
static uint8_T SupervisorB2_closeRange(uint16_T sonar)
{
  return (uint8_T)((sonar > 75) && (sonar < 150));
}

/* Function for Chart: '<S9>/SuperB2_DEGB1_0' */
static void SupervisorB2_timers(const real32_T *gyro_angle, int32_T *sfEvent)
{
  int32_T b_previousEvent;
  if (SupervisorB2_DW.is_active_timerSonar12 != 0) {
    switch (SupervisorB2_DW.is_timerSonar12) {
     case SupervisorB2_IN_Fall1Detected:
      if (SupervisorB2_DW.temporalCounter_i2 >= 150) {
        SupervisorB2_DW.is_timerSonar12 = SupervisorB2_IN_Waiting_i;
      } else if (SupervisorB2_DW.obj2Detected != 0) {
        b_previousEvent = *sfEvent;
        *sfEvent = SupervisorB2_event_moveToS1;
        if (SupervisorB2_DW.is_active_B2Decisions != 0) {
          SupervisorB2_B2Decisions(gyro_angle, sfEvent);
        }

        *sfEvent = b_previousEvent;
        SupervisorB2_DW.is_timerSonar12 = SupervisorB2_IN_Waiting_i;
      }
      break;

     case SupervisorB2_IN_Waiting_i:
      if (*sfEvent == SupervisorB2_event_Fall1) {
        SupervisorB2_DW.temporalCounter_i2 = 0U;
        SupervisorB2_DW.is_timerSonar12 = SupervisorB2_IN_Fall1Detected;
      }
      break;
    }
  }

  if (SupervisorB2_DW.is_active_timerSonar21 != 0) {
    switch (SupervisorB2_DW.is_timerSonar21) {
     case SupervisorB2_IN_Fall1Detected:
      if (SupervisorB2_DW.temporalCounter_i3 >= 150) {
        SupervisorB2_DW.is_timerSonar21 = SupervisorB2_IN_Waiting_i;
      } else if (SupervisorB2_DW.obj1Detected != 0) {
        b_previousEvent = *sfEvent;
        *sfEvent = SupervisorB2_event_avoidS1;
        if (SupervisorB2_DW.is_active_B2Decisions != 0) {
          SupervisorB2_B2Decisions(gyro_angle, sfEvent);
        }

        *sfEvent = b_previousEvent;
        SupervisorB2_DW.is_timerSonar21 = SupervisorB2_IN_Waiting_i;
      }
      break;

     case SupervisorB2_IN_Waiting_i:
      if (*sfEvent == SupervisorB2_event_Fall2) {
        SupervisorB2_DW.temporalCounter_i3 = 0U;
        SupervisorB2_DW.is_timerSonar21 = SupervisorB2_IN_Fall1Detected;
      }
      break;
    }
  }

  if (SupervisorB2_DW.is_active_timerSonar23 != 0) {
    switch (SupervisorB2_DW.is_timerSonar23) {
     case SupervisorB2_IN_Fall1Detected:
      if (SupervisorB2_DW.temporalCounter_i4 >= 150) {
        SupervisorB2_DW.is_timerSonar23 = SupervisorB2_IN_Waiting_i;
      } else if (SupervisorB2_DW.obj3Detected != 0) {
        b_previousEvent = *sfEvent;
        *sfEvent = SupervisorB2_event_avoidS3;
        if (SupervisorB2_DW.is_active_B2Decisions != 0) {
          SupervisorB2_B2Decisions(gyro_angle, sfEvent);
        }

        *sfEvent = b_previousEvent;
        SupervisorB2_DW.is_timerSonar23 = SupervisorB2_IN_Waiting_i;
      }
      break;

     case SupervisorB2_IN_Waiting_i:
      if (*sfEvent == SupervisorB2_event_Fall2) {
        SupervisorB2_DW.temporalCounter_i4 = 0U;
        SupervisorB2_DW.is_timerSonar23 = SupervisorB2_IN_Fall1Detected;
      }
      break;
    }
  }

  if (SupervisorB2_DW.is_active_timerSonar32 != 0) {
    switch (SupervisorB2_DW.is_timerSonar32) {
     case SupervisorB2_IN_Fall1Detected:
      if (SupervisorB2_DW.temporalCounter_i5 >= 150) {
        SupervisorB2_DW.is_timerSonar32 = SupervisorB2_IN_Waiting_i;
      } else if (SupervisorB2_DW.obj2Detected != 0) {
        b_previousEvent = *sfEvent;
        *sfEvent = SupervisorB2_event_moveToS3;
        if (SupervisorB2_DW.is_active_B2Decisions != 0) {
          SupervisorB2_B2Decisions(gyro_angle, sfEvent);
        }

        *sfEvent = b_previousEvent;
        SupervisorB2_DW.is_timerSonar32 = SupervisorB2_IN_Waiting_i;
      }
      break;

     case SupervisorB2_IN_Waiting_i:
      if (*sfEvent == SupervisorB2_event_Fall3) {
        SupervisorB2_DW.temporalCounter_i5 = 0U;
        SupervisorB2_DW.is_timerSonar32 = SupervisorB2_IN_Fall1Detected;
      }
      break;
    }
  }
}

real_T rt_roundd_snf(real_T u)
{
  real_T y;
  if (fabs(u) < 4.503599627370496E+15) {
    if (u >= 0.5) {
      y = floor(u + 0.5);
    } else if (u > -0.5) {
      y = u * 0.0;
    } else {
      y = ceil(u - 0.5);
    }
  } else {
    y = u;
  }

  return y;
}

/* Function for Chart: '<Root>/Monitor Board Status1' */
static boolean_T Supe_isCommDegradedByMeanPeriod(uint32_T data_last_valid_ms,
  real_T mean_threshold_ms)
{
  real_T old;
  uint32_T mean_dt;
  uint32_T q0;
  boolean_T comm_degraded;
  if (!SupervisorB2_DW.last_valid_prev_not_empty) {
    SupervisorB2_DW.last_valid_prev = data_last_valid_ms;
    SupervisorB2_DW.last_valid_prev_not_empty = true;
    memset(&SupervisorB2_DW.buf[0], 0, 10U * sizeof(real_T));
    SupervisorB2_DW.idx = 1.0;
    SupervisorB2_DW.count = 0.0;
    SupervisorB2_DW.sum_dt = 0U;
    comm_degraded = false;
  } else {
    if (data_last_valid_ms != SupervisorB2_DW.last_valid_prev) {
      mean_dt = data_last_valid_ms -
        /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
        /*MW:OvSatOk*/ SupervisorB2_DW.last_valid_prev;
      if (mean_dt > data_last_valid_ms) {
        mean_dt = 0U;
      }

      SupervisorB2_DW.last_valid_prev = data_last_valid_ms;
      old = SupervisorB2_DW.buf[(int32_T)SupervisorB2_DW.idx - 1];
      SupervisorB2_DW.buf[(int32_T)SupervisorB2_DW.idx - 1] = mean_dt;
      old = rt_roundd_snf((real_T)SupervisorB2_DW.sum_dt - old);
      if (old < 4.294967296E+9) {
        if (old >= 0.0) {
          q0 = (uint32_T)old;
        } else {
          q0 = 0U;
        }
      } else {
        q0 = MAX_uint32_T;
      }

      SupervisorB2_DW.sum_dt = q0 + /*MW:OvSatOk*/ mean_dt;
      if (SupervisorB2_DW.sum_dt < q0) {
        SupervisorB2_DW.sum_dt = MAX_uint32_T;
      }

      SupervisorB2_DW.idx++;
      if (SupervisorB2_DW.idx > 10.0) {
        SupervisorB2_DW.idx = 1.0;
      }

      if (SupervisorB2_DW.count < 10.0) {
        SupervisorB2_DW.count++;
      }
    }

    if (SupervisorB2_DW.count > 0.0) {
      old = rt_roundd_snf((real_T)SupervisorB2_DW.sum_dt / SupervisorB2_DW.count);
      if (old < 4.294967296E+9) {
        mean_dt = (uint32_T)old;
      } else {
        mean_dt = MAX_uint32_T;
      }
    } else {
      mean_dt = 0U;
    }

    comm_degraded = (mean_dt > mean_threshold_ms);
  }

  return comm_degraded;
}

/* Function for Chart: '<Root>/Monitor Board Status1' */
static void SupervisorB2_MonitorRx(RxStatus *rx_status)
{
  uint32_T qY;
  switch (SupervisorB2_DW.is_MonitorRx) {
   case SupervisorB2_IN_Rx_critical:
    *rx_status = RX_CRITICAL;
    if (SupervisorB2_DW.degraded_rx) {
      SupervisorB2_DW.durationCounter_1_gb = 0U;
    }

    if (SupervisorB2_DW.durationCounter_1_gb > 50U) {
      SupervisorB2_DW.is_MonitorRx = SupervisorB2_IN_Rx_ok;
      *rx_status = RX_OK;
    } else {
      /* Inport: '<Root>/Board1_Data' */
      SupervisorB2_DW.degraded_rx = Supe_isCommDegradedByMeanPeriod
        (SupervisorB2_U.Board1_Data.data_last_valid_ms, 40.0);
      if (SupervisorB2_DW.degraded_rx) {
        SupervisorB2_DW.durationCounter_1_gb = 0U;
        SupervisorB2_DW.durationCounter_1_i = 0U;
      }
    }
    break;

   case SupervisorB2_IN_Rx_degraded:
    *rx_status = RX_DEGRADED;
    if (SupervisorB2_DW.degraded_rx) {
      SupervisorB2_DW.durationCounter_1_i = 0U;
    }

    if (SupervisorB2_DW.durationCounter_1_i > 50U) {
      SupervisorB2_DW.is_MonitorRx = SupervisorB2_IN_Rx_ok;
      *rx_status = RX_OK;
    } else {
      /* Inport: '<Root>/now_ms' incorporates:
       *  Inport: '<Root>/Board1_Data'
       */
      qY = SupervisorB2_U.now_ms -
        /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
        /*MW:OvSatOk*/ SupervisorB2_U.Board1_Data.data_last_valid_ms;
      if (qY > SupervisorB2_U.now_ms) {
        qY = 0U;
      }

      if (qY > 120U) {
        SupervisorB2_DW.durationCounter_1_gb = 0U;
        SupervisorB2_DW.is_MonitorRx = SupervisorB2_IN_Rx_critical;
        *rx_status = RX_CRITICAL;
      } else {
        /* Inport: '<Root>/Board1_Data' */
        SupervisorB2_DW.degraded_rx = Supe_isCommDegradedByMeanPeriod
          (SupervisorB2_U.Board1_Data.data_last_valid_ms, 40.0);
        if (SupervisorB2_DW.degraded_rx) {
          SupervisorB2_DW.durationCounter_1_gb = 0U;
          SupervisorB2_DW.durationCounter_1_i = 0U;
        }
      }
    }
    break;

   default:
    /* case IN_Rx_ok: */
    *rx_status = RX_OK;
    if (SupervisorB2_DW.degraded_rx) {
      SupervisorB2_DW.durationCounter_1_i = 0U;
      SupervisorB2_DW.is_MonitorRx = SupervisorB2_IN_Rx_degraded;
      *rx_status = RX_DEGRADED;
    } else {
      /* Inport: '<Root>/now_ms' incorporates:
       *  Inport: '<Root>/Board1_Data'
       */
      qY = SupervisorB2_U.now_ms -
        /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
        /*MW:OvSatOk*/ SupervisorB2_U.Board1_Data.data_last_valid_ms;
      if (qY > SupervisorB2_U.now_ms) {
        qY = 0U;
      }

      if (qY > 120U) {
        SupervisorB2_DW.durationCounter_1_gb = 0U;
        SupervisorB2_DW.is_MonitorRx = SupervisorB2_IN_Rx_critical;
        *rx_status = RX_CRITICAL;
      } else {
        /* Inport: '<Root>/Board1_Data' */
        SupervisorB2_DW.degraded_rx = Supe_isCommDegradedByMeanPeriod
          (SupervisorB2_U.Board1_Data.data_last_valid_ms, 40.0);
        if (SupervisorB2_DW.degraded_rx) {
          SupervisorB2_DW.durationCounter_1_gb = 0U;
          SupervisorB2_DW.durationCounter_1_i = 0U;
        }
      }
    }
    break;
  }
}

/* Function for Chart: '<S14>/SuperB2_DEGB1_1' */
static uint8_T Supervis_check_emergency_stop_e(const uint16_T sonars[3])
{
  uint8_T stop;
  if (sonars[0] < 300) {
    stop = 1U;
  } else {
    stop = (uint8_T)(sonars[1] < 300);
  }

  return stop;
}

/* Function for Chart: '<S5>/Check rover safety state1' */
static void SupervisorB2_updateSafetyLimits(SafetyStatus rover_state, real_T
  *V_MAX, real_T *OMEGA_MAX)
{
  *V_MAX = 0.5;
  *OMEGA_MAX = 0.5;
  if (rover_state == SAFETY_CRITICAL) {
    *V_MAX = 0.0;
    *OMEGA_MAX = 0.0;
  }
}

/* Function for Chart: '<S5>/Check rover safety state1' */
static real32_T SupervisorB2_angleError(real32_T gyro_angle, real32_T
  targetAngle)
{
  real32_T x;
  x = (targetAngle - gyro_angle) + 180.0F;
  if (rtIsNaNF(x)) {
    x = (rtNaNF);
  } else if (rtIsInfF(x)) {
    x = (rtNaNF);
  } else if (x == 0.0F) {
    x = 0.0F;
  } else {
    x = fmodf(x, 360.0F);
    if (x == 0.0F) {
      x = 0.0F;
    } else if (x < 0.0F) {
      x += 360.0F;
    }
  }

  return x - 180.0F;
}

/* Function for Chart: '<S5>/Check rover safety state1' */
static real32_T SupervisorB2_angleCalculator180(real32_T gyro_angle)
{
  real32_T targetAngle;
  if (gyro_angle + 180.0F > 360.0F) {
    targetAngle = (gyro_angle + 180.0F) - 360.0F;
  } else {
    targetAngle = gyro_angle + 180.0F;
  }

  return targetAngle;
}

/* Function for Chart: '<S5>/Check rover safety state1' */
static boolean_T SupervisorB2_checkStop(const real32_T wheel_speeds[4])
{
  int32_T b_k;
  boolean_T x[4];
  boolean_T exitg1;
  boolean_T stop;
  x[0] = (fabsf(wheel_speeds[0]) < 2.5F);
  x[1] = (fabsf(wheel_speeds[1]) < 2.5F);
  x[2] = (fabsf(wheel_speeds[2]) < 2.5F);
  x[3] = (fabsf(wheel_speeds[3]) < 2.5F);
  stop = true;
  b_k = 0;
  exitg1 = false;
  while ((!exitg1) && (b_k < 4)) {
    if (!x[b_k]) {
      stop = false;
      exitg1 = true;
    } else {
      b_k++;
    }
  }

  return stop;
}

/* Model step function */
void SupervisorB2_step(void)
{
  real_T OMEGA_MAX;
  real_T V_MAX;
  real_T err;
  int32_T degr_mask;
  int32_T sfEvent;
  real32_T angle_err;
  real32_T omega_user;
  uint32_T elapsedTicks;
  uint32_T tmp;
  boolean_T guard1;
  boolean_T rtb_b1_requests_switch;
  boolean_T rtb_emergency_stop_required;
  boolean_T rtb_emergency_stop_required_m;
  EspStatus esp_status;
  ImuStatus imu_status;
  RxStatus rx_status;
  SafetyStatus rtb_rover_safety_state;
  SupervisorStatus b1_sup_status;

  /* Chart: '<Root>/Generate Decision for B1' */
  if (SupervisorB2_DW.is_active_c3_SupervisorB2 == 0) {
    SupervisorB2_DW.is_active_c3_SupervisorB2 = 1U;
  } else {
    /* Outputs for Function Call SubSystem: '<S4>/superB2_DEGB1_0' */
    /* Chart: '<S9>/SuperB2_DEGB1_0' incorporates:
     *  Inport: '<Root>/IMU'
     *  Inport: '<Root>/Sonars'
     */
    elapsedTicks = SupervisorB2_M->Timing.clockTick0 -
      SupervisorB2_DW.previousTicks;
    SupervisorB2_DW.previousTicks = SupervisorB2_M->Timing.clockTick0;
    tmp = SupervisorB2_DW.temporalCounter_i1_p + elapsedTicks;
    if (tmp <= 31U) {
      SupervisorB2_DW.temporalCounter_i1_p = (uint8_T)tmp;
    } else {
      SupervisorB2_DW.temporalCounter_i1_p = 31U;
    }

    tmp = SupervisorB2_DW.temporalCounter_i2 + elapsedTicks;
    if (tmp <= 255U) {
      SupervisorB2_DW.temporalCounter_i2 = (uint8_T)tmp;
    } else {
      SupervisorB2_DW.temporalCounter_i2 = MAX_uint8_T;
    }

    tmp = SupervisorB2_DW.temporalCounter_i3 + elapsedTicks;
    if (tmp <= 255U) {
      SupervisorB2_DW.temporalCounter_i3 = (uint8_T)tmp;
    } else {
      SupervisorB2_DW.temporalCounter_i3 = MAX_uint8_T;
    }

    tmp = SupervisorB2_DW.temporalCounter_i4 + elapsedTicks;
    if (tmp <= 255U) {
      SupervisorB2_DW.temporalCounter_i4 = (uint8_T)tmp;
    } else {
      SupervisorB2_DW.temporalCounter_i4 = MAX_uint8_T;
    }

    tmp = SupervisorB2_DW.temporalCounter_i5 + elapsedTicks;
    if (tmp <= 255U) {
      SupervisorB2_DW.temporalCounter_i5 = (uint8_T)tmp;
    } else {
      SupervisorB2_DW.temporalCounter_i5 = MAX_uint8_T;
    }

    sfEvent = -1;
    if (SupervisorB2_DW.is_active_c1_SupervisorB2 == 0) {
      SupervisorB2_DW.is_active_c1_SupervisorB2 = 1U;
      SupervisorB2_DW.is_active_B2Decisions = 1U;
      SupervisorB2_DW.is_B2Decisions = SupervisorB2_IN_Waiting;
      SupervisorB2_B.B2Decision_c = CMD_NORMAL;
      SupervisorB2_DW.is_active_Sonars = 1U;
      SupervisorB2_DW.is_active_distance_70 = 1U;
      SupervisorB2_DW.is_distance_70 = Su_IN_check_sonars_for_stopping;
      SupervisorB2_DW.stop = Supervisor_check_emergency_stop
        (SupervisorB2_U.Sonars.dist_cm);
      SupervisorB2_DW.is_active_distance_gt70 = 1U;
      SupervisorB2_DW.is_active_Waiting_S1 = 1U;
      SupervisorB2_DW.is_Waiting_S1 = SupervisorB2_IN_WS1;
      SupervisorB2_DW.isClose1 = SupervisorB2_closeRange
        (SupervisorB2_U.Sonars.dist_cm[0]);
      SupervisorB2_DW.is_active_Waiting_S2 = 1U;
      SupervisorB2_DW.is_Waiting_S2 = SupervisorB2_IN_WS2;
      SupervisorB2_DW.isClose2 = SupervisorB2_closeRange
        (SupervisorB2_U.Sonars.dist_cm[1]);
      SupervisorB2_DW.is_active_Waiting_S3 = 1U;
      SupervisorB2_DW.is_Waiting_S3 = SupervisorB2_IN_WS3;
      SupervisorB2_DW.isClose3 = SupervisorB2_closeRange
        (SupervisorB2_U.Sonars.dist_cm[2]);
      SupervisorB2_DW.is_active_timers = 1U;
      SupervisorB2_DW.is_active_timerSonar12 = 1U;
      SupervisorB2_DW.is_timerSonar12 = SupervisorB2_IN_Waiting_i;
      SupervisorB2_DW.is_active_timerSonar21 = 1U;
      SupervisorB2_DW.is_timerSonar21 = SupervisorB2_IN_Waiting_i;
      SupervisorB2_DW.is_active_timerSonar23 = 1U;
      SupervisorB2_DW.is_timerSonar23 = SupervisorB2_IN_Waiting_i;
      SupervisorB2_DW.is_active_timerSonar32 = 1U;
      SupervisorB2_DW.is_timerSonar32 = SupervisorB2_IN_Waiting_i;
    } else {
      if (SupervisorB2_DW.is_active_B2Decisions != 0) {
        SupervisorB2_B2Decisions(&SupervisorB2_U.IMU.yaw, &sfEvent);
      }

      if (SupervisorB2_DW.is_active_Sonars != 0) {
        if (SupervisorB2_DW.is_active_distance_70 != 0) {
          switch (SupervisorB2_DW.is_distance_70) {
           case IN_check_sonars_for_moving_agai:
            if (SupervisorB2_DW.stop == 0) {
              sfEvent = SupervisorB2_event_safe;
              if (SupervisorB2_DW.is_active_B2Decisions != 0) {
                SupervisorB2_B2Decisions(&SupervisorB2_U.IMU.yaw, &sfEvent);
              }

              sfEvent = -1;
              SupervisorB2_DW.is_distance_70 = Su_IN_check_sonars_for_stopping;
              SupervisorB2_DW.stop = Supervisor_check_emergency_stop
                (SupervisorB2_U.Sonars.dist_cm);
            } else {
              SupervisorB2_DW.stop = Supervisor_check_emergency_stop
                (SupervisorB2_U.Sonars.dist_cm);
            }
            break;

           case Su_IN_check_sonars_for_stopping:
            if (SupervisorB2_DW.stop != 0) {
              sfEvent = SupervisorB2_event_emergency;
              if (SupervisorB2_DW.is_active_B2Decisions != 0) {
                SupervisorB2_B2Decisions(&SupervisorB2_U.IMU.yaw, &sfEvent);
              }

              sfEvent = -1;
              SupervisorB2_DW.is_distance_70 = IN_check_sonars_for_moving_agai;
              SupervisorB2_DW.stop = Supervisor_check_emergency_stop
                (SupervisorB2_U.Sonars.dist_cm);
            } else {
              SupervisorB2_DW.stop = Supervisor_check_emergency_stop
                (SupervisorB2_U.Sonars.dist_cm);
            }
            break;
          }
        }

        if (SupervisorB2_DW.is_active_distance_gt70 != 0) {
          if ((SupervisorB2_DW.is_active_Waiting_S1 != 0) &&
              (SupervisorB2_DW.is_Waiting_S1 == SupervisorB2_IN_WS1)) {
            if (SupervisorB2_DW.stop == 0) {
              if (SupervisorB2_DW.isClose1 != 0) {
                SupervisorB2_DW.obj1Detected = 1U;
                SupervisorB2_DW.isClose1 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[0]);
              } else if (SupervisorB2_DW.obj1Detected == 1) {
                SupervisorB2_DW.obj1Detected = 0U;
                sfEvent = SupervisorB2_event_Fall1;
                if (SupervisorB2_DW.is_active_timers != 0) {
                  SupervisorB2_timers(&SupervisorB2_U.IMU.yaw, &sfEvent);
                }

                sfEvent = -1;
                SupervisorB2_DW.isClose1 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[0]);
              } else {
                SupervisorB2_DW.isClose1 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[0]);
              }
            } else {
              SupervisorB2_DW.isClose1 = SupervisorB2_closeRange
                (SupervisorB2_U.Sonars.dist_cm[0]);
            }
          }

          if ((SupervisorB2_DW.is_active_Waiting_S2 != 0) &&
              (SupervisorB2_DW.is_Waiting_S2 == SupervisorB2_IN_WS2)) {
            if (SupervisorB2_DW.stop == 0) {
              if (SupervisorB2_DW.isClose2 != 0) {
                SupervisorB2_DW.obj2Detected = 1U;
                SupervisorB2_DW.isClose2 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[1]);
              } else if (SupervisorB2_DW.obj2Detected == 1) {
                SupervisorB2_DW.obj2Detected = 0U;
                sfEvent = SupervisorB2_event_Fall2;
                if (SupervisorB2_DW.is_active_timers != 0) {
                  SupervisorB2_timers(&SupervisorB2_U.IMU.yaw, &sfEvent);
                }

                sfEvent = -1;
                SupervisorB2_DW.isClose2 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[1]);
              } else {
                SupervisorB2_DW.isClose2 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[1]);
              }
            } else {
              SupervisorB2_DW.isClose2 = SupervisorB2_closeRange
                (SupervisorB2_U.Sonars.dist_cm[1]);
            }
          }

          if ((SupervisorB2_DW.is_active_Waiting_S3 != 0) &&
              (SupervisorB2_DW.is_Waiting_S3 == SupervisorB2_IN_WS3)) {
            if (SupervisorB2_DW.stop == 0) {
              if (SupervisorB2_DW.isClose3 != 0) {
                SupervisorB2_DW.obj3Detected = 1U;
                SupervisorB2_DW.isClose3 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[2]);
              } else if (SupervisorB2_DW.obj3Detected == 1) {
                SupervisorB2_DW.obj3Detected = 0U;
                sfEvent = SupervisorB2_event_Fall3;
                if (SupervisorB2_DW.is_active_timers != 0) {
                  SupervisorB2_timers(&SupervisorB2_U.IMU.yaw, &sfEvent);
                }

                sfEvent = -1;
                SupervisorB2_DW.isClose3 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[2]);
              } else {
                SupervisorB2_DW.isClose3 = SupervisorB2_closeRange
                  (SupervisorB2_U.Sonars.dist_cm[2]);
              }
            } else {
              SupervisorB2_DW.isClose3 = SupervisorB2_closeRange
                (SupervisorB2_U.Sonars.dist_cm[2]);
            }
          }
        }

        if (SupervisorB2_DW.is_active_timers != 0) {
          SupervisorB2_timers(&SupervisorB2_U.IMU.yaw, &sfEvent);
        }
      }
    }

    /* End of Chart: '<S9>/SuperB2_DEGB1_0' */
    /* End of Outputs for SubSystem: '<S4>/superB2_DEGB1_0' */

    /* Outport: '<Root>/B2Decision' */
    SupervisorB2_Y.B2Decision = SupervisorB2_B.B2Decision_c;
  }

  /* End of Chart: '<Root>/Generate Decision for B1' */

  /* Chart: '<Root>/Monitor Board Status1' incorporates:
   *  Inport: '<Root>/BLE'
   *  Inport: '<Root>/IMU'
   *  Inport: '<Root>/last_valid_b1_ms'
   *  Inport: '<Root>/now_ms'
   */
  if (SupervisorB2_DW.is_active_c13_SupervisorB2 == 0) {
    SupervisorB2_DW.is_active_c13_SupervisorB2 = 1U;
    SupervisorB2_DW.is_MonitorBoard1Supervisor = SupervisorB2_IN_B1_sup_ok;
    b1_sup_status = SUPERVISOR_OK;
    SupervisorB2_DW.is_MonitorBLE = SupervisorB2_IN_ESP_ok;
    esp_status = ESP_I2C_OK;
    SupervisorB2_DW.is_MonitorIMU = SupervisorB2_IN_IMU_ok;
    imu_status = IMU_I2C_OK;
    SupervisorB2_DW.is_MonitorRx = SupervisorB2_IN_Rx_ok;
    rx_status = RX_OK;
  } else {
    switch (SupervisorB2_DW.is_MonitorBoard1Supervisor) {
     case SupervisorB2_IN_B1_sup_critical:
      b1_sup_status = SUPERVISOR_CRITICAL;
      if (SupervisorB2_DW.degraded_sup) {
        SupervisorB2_DW.durationCounter_1_a = 0U;
      }

      if (SupervisorB2_DW.durationCounter_1_a > 100U) {
        SupervisorB2_DW.is_MonitorBoard1Supervisor = SupervisorB2_IN_B1_sup_ok;
        b1_sup_status = SUPERVISOR_OK;
      } else {
        SupervisorB2_DW.degraded_sup = Supe_isCommDegradedByMeanPeriod
          (SupervisorB2_U.last_valid_b1_ms, 60.0);
        if (SupervisorB2_DW.degraded_sup) {
          SupervisorB2_DW.durationCounter_1_a = 0U;
          SupervisorB2_DW.durationCounter_1_f = 0U;
        }
      }
      break;

     case SupervisorB2_IN_B1_sup_degraded:
      b1_sup_status = SUPERVISOR_DEGRADED;
      if (SupervisorB2_DW.degraded_sup) {
        SupervisorB2_DW.durationCounter_1_f = 0U;
      }

      if (SupervisorB2_DW.durationCounter_1_f > 50U) {
        SupervisorB2_DW.is_MonitorBoard1Supervisor = SupervisorB2_IN_B1_sup_ok;
        b1_sup_status = SUPERVISOR_OK;
      } else {
        elapsedTicks = SupervisorB2_U.now_ms -
          /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
          /*MW:OvSatOk*/ SupervisorB2_U.last_valid_b1_ms;
        if (elapsedTicks > SupervisorB2_U.now_ms) {
          elapsedTicks = 0U;
        }

        if (elapsedTicks > 150U) {
          SupervisorB2_DW.durationCounter_1_a = 0U;
          SupervisorB2_DW.is_MonitorBoard1Supervisor =
            SupervisorB2_IN_B1_sup_critical;
          b1_sup_status = SUPERVISOR_CRITICAL;
        } else {
          SupervisorB2_DW.degraded_sup = Supe_isCommDegradedByMeanPeriod
            (SupervisorB2_U.last_valid_b1_ms, 60.0);
          if (SupervisorB2_DW.degraded_sup) {
            SupervisorB2_DW.durationCounter_1_a = 0U;
            SupervisorB2_DW.durationCounter_1_f = 0U;
          }
        }
      }
      break;

     default:
      /* case IN_B1_sup_ok: */
      b1_sup_status = SUPERVISOR_OK;
      if (SupervisorB2_DW.degraded_sup) {
        SupervisorB2_DW.durationCounter_1_f = 0U;
        SupervisorB2_DW.is_MonitorBoard1Supervisor =
          SupervisorB2_IN_B1_sup_degraded;
        b1_sup_status = SUPERVISOR_DEGRADED;
      } else {
        elapsedTicks = SupervisorB2_U.now_ms -
          /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
          /*MW:OvSatOk*/ SupervisorB2_U.last_valid_b1_ms;
        if (elapsedTicks > SupervisorB2_U.now_ms) {
          elapsedTicks = 0U;
        }

        if (elapsedTicks > 150U) {
          SupervisorB2_DW.durationCounter_1_a = 0U;
          SupervisorB2_DW.is_MonitorBoard1Supervisor =
            SupervisorB2_IN_B1_sup_critical;
          b1_sup_status = SUPERVISOR_CRITICAL;
        } else {
          SupervisorB2_DW.degraded_sup = Supe_isCommDegradedByMeanPeriod
            (SupervisorB2_U.last_valid_b1_ms, 60.0);
          if (SupervisorB2_DW.degraded_sup) {
            SupervisorB2_DW.durationCounter_1_a = 0U;
            SupervisorB2_DW.durationCounter_1_f = 0U;
          }
        }
      }
      break;
    }

    switch (SupervisorB2_DW.is_MonitorBLE) {
     case SupervisorB2_IN_ESP_critical:
      esp_status = ESP_I2C_CRITICAL;
      if (SupervisorB2_DW.degraded_esp) {
        SupervisorB2_DW.durationCounter_1 = 0U;
      }

      if (SupervisorB2_DW.durationCounter_1 > 50U) {
        SupervisorB2_DW.is_MonitorBLE = SupervisorB2_IN_ESP_ok;
        esp_status = ESP_I2C_OK;
      } else {
        SupervisorB2_DW.degraded_esp = Supe_isCommDegradedByMeanPeriod
          (SupervisorB2_U.BLE.data_last_valid_ms, 40.0);
        if (SupervisorB2_DW.degraded_esp) {
          SupervisorB2_DW.durationCounter_1 = 0U;
          SupervisorB2_DW.durationCounter_1_d = 0U;
        }
      }
      break;

     case SupervisorB2_IN_ESP_degraded:
      esp_status = ESP_I2C_DEGRADED;
      if (SupervisorB2_DW.degraded_esp) {
        SupervisorB2_DW.durationCounter_1_d = 0U;
      }

      if (SupervisorB2_DW.durationCounter_1_d > 50U) {
        SupervisorB2_DW.is_MonitorBLE = SupervisorB2_IN_ESP_ok;
        esp_status = ESP_I2C_OK;
      } else {
        elapsedTicks = SupervisorB2_U.now_ms -
          /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
          /*MW:OvSatOk*/ SupervisorB2_U.BLE.data_last_valid_ms;
        if (elapsedTicks > SupervisorB2_U.now_ms) {
          elapsedTicks = 0U;
        }

        if (elapsedTicks > 120U) {
          SupervisorB2_DW.durationCounter_1 = 0U;
          SupervisorB2_DW.is_MonitorBLE = SupervisorB2_IN_ESP_critical;
          esp_status = ESP_I2C_CRITICAL;
        } else {
          SupervisorB2_DW.degraded_esp = Supe_isCommDegradedByMeanPeriod
            (SupervisorB2_U.BLE.data_last_valid_ms, 40.0);
          if (SupervisorB2_DW.degraded_esp) {
            SupervisorB2_DW.durationCounter_1 = 0U;
            SupervisorB2_DW.durationCounter_1_d = 0U;
          }
        }
      }
      break;

     default:
      /* case IN_ESP_ok: */
      esp_status = ESP_I2C_OK;
      if (SupervisorB2_DW.degraded_esp) {
        SupervisorB2_DW.durationCounter_1_d = 0U;
        SupervisorB2_DW.is_MonitorBLE = SupervisorB2_IN_ESP_degraded;
        esp_status = ESP_I2C_DEGRADED;
      } else {
        elapsedTicks = SupervisorB2_U.now_ms -
          /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
          /*MW:OvSatOk*/ SupervisorB2_U.BLE.data_last_valid_ms;
        if (elapsedTicks > SupervisorB2_U.now_ms) {
          elapsedTicks = 0U;
        }

        if (elapsedTicks > 120U) {
          SupervisorB2_DW.durationCounter_1 = 0U;
          SupervisorB2_DW.is_MonitorBLE = SupervisorB2_IN_ESP_critical;
          esp_status = ESP_I2C_CRITICAL;
        } else {
          SupervisorB2_DW.degraded_esp = Supe_isCommDegradedByMeanPeriod
            (SupervisorB2_U.BLE.data_last_valid_ms, 40.0);
          if (SupervisorB2_DW.degraded_esp) {
            SupervisorB2_DW.durationCounter_1 = 0U;
            SupervisorB2_DW.durationCounter_1_d = 0U;
          }
        }
      }
      break;
    }

    switch (SupervisorB2_DW.is_MonitorIMU) {
     case SupervisorB2_IN_IMU_critical:
      imu_status = IMU_I2C_CRITICAL;
      if (SupervisorB2_DW.degraded_imu) {
        SupervisorB2_DW.durationCounter_1_g = 0U;
      }

      if (SupervisorB2_DW.durationCounter_1_g > 50U) {
        SupervisorB2_DW.is_MonitorIMU = SupervisorB2_IN_IMU_ok;
        imu_status = IMU_I2C_OK;
      } else {
        SupervisorB2_DW.degraded_imu = Supe_isCommDegradedByMeanPeriod
          (SupervisorB2_U.IMU.data_last_valid_ms, 100.0);
        if (SupervisorB2_DW.degraded_imu) {
          SupervisorB2_DW.durationCounter_1_g = 0U;
          SupervisorB2_DW.durationCounter_1_e = 0U;
        }
      }
      break;

     case SupervisorB2_IN_IMU_degraded:
      imu_status = IMU_I2C_DEGRADED;
      if (SupervisorB2_DW.degraded_imu) {
        SupervisorB2_DW.durationCounter_1_e = 0U;
      }

      if (SupervisorB2_DW.durationCounter_1_e > 50U) {
        SupervisorB2_DW.is_MonitorIMU = SupervisorB2_IN_IMU_ok;
        imu_status = IMU_I2C_OK;
      } else {
        elapsedTicks = SupervisorB2_U.now_ms -
          /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
          /*MW:OvSatOk*/ SupervisorB2_U.IMU.data_last_valid_ms;
        if (elapsedTicks > SupervisorB2_U.now_ms) {
          elapsedTicks = 0U;
        }

        if (elapsedTicks > 200U) {
          SupervisorB2_DW.durationCounter_1_g = 0U;
          SupervisorB2_DW.is_MonitorIMU = SupervisorB2_IN_IMU_critical;
          imu_status = IMU_I2C_CRITICAL;
        } else {
          SupervisorB2_DW.degraded_imu = Supe_isCommDegradedByMeanPeriod
            (SupervisorB2_U.IMU.data_last_valid_ms, 100.0);
          if (SupervisorB2_DW.degraded_imu) {
            SupervisorB2_DW.durationCounter_1_g = 0U;
            SupervisorB2_DW.durationCounter_1_e = 0U;
          }
        }
      }
      break;

     default:
      /* case IN_IMU_ok: */
      imu_status = IMU_I2C_OK;
      if (SupervisorB2_DW.degraded_imu) {
        SupervisorB2_DW.durationCounter_1_e = 0U;
        SupervisorB2_DW.is_MonitorIMU = SupervisorB2_IN_IMU_degraded;
        imu_status = IMU_I2C_DEGRADED;
      } else {
        elapsedTicks = SupervisorB2_U.now_ms -
          /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
          /*MW:OvSatOk*/ SupervisorB2_U.IMU.data_last_valid_ms;
        if (elapsedTicks > SupervisorB2_U.now_ms) {
          elapsedTicks = 0U;
        }

        if (elapsedTicks > 200U) {
          SupervisorB2_DW.durationCounter_1_g = 0U;
          SupervisorB2_DW.is_MonitorIMU = SupervisorB2_IN_IMU_critical;
          imu_status = IMU_I2C_CRITICAL;
        } else {
          SupervisorB2_DW.degraded_imu = Supe_isCommDegradedByMeanPeriod
            (SupervisorB2_U.IMU.data_last_valid_ms, 100.0);
          if (SupervisorB2_DW.degraded_imu) {
            SupervisorB2_DW.durationCounter_1_g = 0U;
            SupervisorB2_DW.durationCounter_1_e = 0U;
          }
        }
      }
      break;
    }

    SupervisorB2_MonitorRx(&rx_status);
  }

  if (!SupervisorB2_DW.degraded_esp) {
    SupervisorB2_DW.durationCounter_1++;
    SupervisorB2_DW.durationCounter_1_d++;
  } else {
    SupervisorB2_DW.durationCounter_1 = 0U;
    SupervisorB2_DW.durationCounter_1_d = 0U;
  }

  if (!SupervisorB2_DW.degraded_sup) {
    SupervisorB2_DW.durationCounter_1_a++;
    SupervisorB2_DW.durationCounter_1_f++;
  } else {
    SupervisorB2_DW.durationCounter_1_a = 0U;
    SupervisorB2_DW.durationCounter_1_f = 0U;
  }

  if (!SupervisorB2_DW.degraded_imu) {
    SupervisorB2_DW.durationCounter_1_g++;
    SupervisorB2_DW.durationCounter_1_e++;
  } else {
    SupervisorB2_DW.durationCounter_1_g = 0U;
    SupervisorB2_DW.durationCounter_1_e = 0U;
  }

  if (!SupervisorB2_DW.degraded_rx) {
    SupervisorB2_DW.durationCounter_1_gb++;
    SupervisorB2_DW.durationCounter_1_i++;
  } else {
    SupervisorB2_DW.durationCounter_1_gb = 0U;
    SupervisorB2_DW.durationCounter_1_i = 0U;
  }

  /* End of Chart: '<Root>/Monitor Board Status1' */

  /* MATLAB Function: '<Root>/Board 2 fault masks' */
  sfEvent = 0;
  degr_mask = 0;
  switch (esp_status) {
   case ESP_I2C_CRITICAL:
    sfEvent = 1;
    break;

   case ESP_I2C_DEGRADED:
    degr_mask = 1;
    break;
  }

  switch (imu_status) {
   case IMU_I2C_CRITICAL:
    sfEvent = (int32_T)((uint32_T)sfEvent | 2U);
    break;

   case IMU_I2C_DEGRADED:
    degr_mask = (int32_T)((uint32_T)degr_mask | 2U);
    break;
  }

  switch (rx_status) {
   case RX_CRITICAL:
    sfEvent = (int32_T)((uint32_T)sfEvent | 4U);
    break;

   case RX_DEGRADED:
    degr_mask = (int32_T)((uint32_T)degr_mask | 4U);
    break;
  }

  switch (b1_sup_status) {
   case SUPERVISOR_CRITICAL:
    sfEvent = (int32_T)((uint32_T)sfEvent | 8U);
    break;

   case SUPERVISOR_DEGRADED:
    degr_mask = (int32_T)((uint32_T)degr_mask | 8U);
    break;
  }

  /* Outport: '<Root>/critical_mask' incorporates:
   *  MATLAB Function: '<Root>/Board 2 fault masks'
   */
  SupervisorB2_Y.critical_mask = (uint32_T)sfEvent;

  /* Outport: '<Root>/degraded_mask' incorporates:
   *  MATLAB Function: '<Root>/Board 2 fault masks'
   */
  SupervisorB2_Y.degraded_mask = (uint32_T)degr_mask;

  /* MATLAB Function: '<Root>/MATLAB Function1' incorporates:
   *  MATLAB Function: '<Root>/Board 2 fault masks'
   */
  rtb_emergency_stop_required = (((uint32_T)sfEvent & 3U) != 0U);

  /* MATLAB Function: '<Root>/MATLAB Function' incorporates:
   *  Inport: '<Root>/Board1_Data'
   */
  rtb_b1_requests_switch = ((SupervisorB2_U.Board1_Data.payload.critical_mask &
    132U) != 0U);
  rtb_emergency_stop_required_m =
    ((SupervisorB2_U.Board1_Data.payload.critical_mask & 4294967163U) != 0U);

  /* Chart: '<Root>/B1_Failure_Fallback' */
  if (SupervisorB2_DW.is_active_c4_SupervisorB2 == 0) {
    SupervisorB2_DW.is_active_c4_SupervisorB2 = 1U;
    SupervisorB2_DW.is_c4_SupervisorB2 = SupervisorB2_IN_B1_actuating;
    SupervisorB2_Y.autorized_to_send_command = false;
  } else if (SupervisorB2_DW.is_c4_SupervisorB2 == SupervisorB2_IN_B1_actuating)
  {
    SupervisorB2_Y.autorized_to_send_command = false;
    if (rtb_b1_requests_switch || (rx_status == RX_CRITICAL) || (b1_sup_status ==
         SUPERVISOR_CRITICAL)) {
      SupervisorB2_DW.durationCounter_1_l = 0U;
      SupervisorB2_DW.is_c4_SupervisorB2 = Supervi_IN_B2_trying_to_actuate;
      SupervisorB2_Y.autorized_to_send_command = true;
    }
  } else {
    /* case IN_B2_trying_to_actuate: */
    SupervisorB2_Y.autorized_to_send_command = true;
    if (rtb_b1_requests_switch || (rx_status == RX_CRITICAL) || (b1_sup_status ==
         SUPERVISOR_CRITICAL)) {
      SupervisorB2_DW.durationCounter_1_l = 0U;
    }

    if (SupervisorB2_DW.durationCounter_1_l > 150U) {
      SupervisorB2_DW.is_c4_SupervisorB2 = SupervisorB2_IN_B1_actuating;
      SupervisorB2_Y.autorized_to_send_command = false;
    }
  }

  if ((!rtb_b1_requests_switch) && (rx_status != RX_CRITICAL) && (b1_sup_status
       != SUPERVISOR_CRITICAL)) {
    SupervisorB2_DW.durationCounter_1_l++;
  } else {
    SupervisorB2_DW.durationCounter_1_l = 0U;
  }

  /* End of Chart: '<Root>/B1_Failure_Fallback' */

  /* Outputs for Enabled SubSystem: '<Root>/Generate speed ref for b1 fallback' incorporates:
   *  EnablePort: '<S5>/Enable'
   */
  if (SupervisorB2_Y.autorized_to_send_command) {
    /* Chart: '<S5>/Check rover safety state' */
    if (SupervisorB2_DW.is_active_c6_SupervisorB2 == 0) {
      SupervisorB2_DW.is_active_c6_SupervisorB2 = 1U;
      SupervisorB2_DW.is_c6_SupervisorB2 = Supervi_IN_Rover_Degraded_State;
      rtb_rover_safety_state = SAFETY_DEGRADED;
    } else if (SupervisorB2_DW.is_c6_SupervisorB2 ==
               Supervi_IN_Rover_Critical_State) {
      rtb_rover_safety_state = SAFETY_CRITICAL;
      if ((!rtb_emergency_stop_required_m) && (!rtb_emergency_stop_required)) {
        SupervisorB2_DW.is_c6_SupervisorB2 = Supervi_IN_Rover_Degraded_State;
        rtb_rover_safety_state = SAFETY_DEGRADED;
      }
    } else {
      /* case IN_Rover_Degraded_State: */
      rtb_rover_safety_state = SAFETY_DEGRADED;
      if (rtb_emergency_stop_required || rtb_emergency_stop_required_m) {
        SupervisorB2_DW.is_c6_SupervisorB2 = Supervi_IN_Rover_Critical_State;
        rtb_rover_safety_state = SAFETY_CRITICAL;
      }
    }

    /* End of Chart: '<S5>/Check rover safety state' */

    /* Chart: '<S5>/Generate Fallback Decision' incorporates:
     *  Chart: '<S14>/SuperB2_DEGB1_1'
     */
    if (SupervisorB2_DW.is_active_c5_SupervisorB2 == 0) {
      SupervisorB2_DW.is_active_c5_SupervisorB2 = 1U;

      /* Outputs for Function Call SubSystem: '<S13>/superB2_DEGB1_1' */
    } else if (SupervisorB2_DW.is_active_c9_SupervisorB2 == 0) {
      /* Chart: '<S14>/SuperB2_DEGB1_1' */
      SupervisorB2_DW.is_active_c9_SupervisorB2 = 1U;
      SupervisorB2_DW.is_c9_SupervisorB2 = Su_IN_check_sonars_for_stopping;
      SupervisorB2_B.B2Decision = CMD_NORMAL;
    } else if (SupervisorB2_DW.is_c9_SupervisorB2 ==
               IN_check_sonars_for_moving_agai) {
      /* Chart: '<S14>/SuperB2_DEGB1_1' incorporates:
       *  Inport: '<Root>/Sonars'
       */
      SupervisorB2_B.B2Decision = CMD_ESTOP;
      if (Supervis_check_emergency_stop_e(SupervisorB2_U.Sonars.dist_cm) == 0) {
        SupervisorB2_DW.is_c9_SupervisorB2 = Su_IN_check_sonars_for_stopping;
        SupervisorB2_B.B2Decision = CMD_NORMAL;
      }
    } else {
      /* Chart: '<S14>/SuperB2_DEGB1_1' incorporates:
       *  Inport: '<Root>/Sonars'
       */
      /* case IN_check_sonars_for_stopping: */
      SupervisorB2_B.B2Decision = CMD_NORMAL;
      if (Supervis_check_emergency_stop_e(SupervisorB2_U.Sonars.dist_cm) != 0) {
        SupervisorB2_DW.is_c9_SupervisorB2 = IN_check_sonars_for_moving_agai;
        SupervisorB2_B.B2Decision = CMD_ESTOP;
      }

      /* End of Outputs for SubSystem: '<S13>/superB2_DEGB1_1' */
    }

    /* End of Chart: '<S5>/Generate Fallback Decision' */

    /* Chart: '<S5>/Check rover safety state1' incorporates:
     *  Inport: '<Root>/BLE'
     *  Inport: '<Root>/Board1_Data'
     *  Inport: '<Root>/IMU'
     */
    if (SupervisorB2_DW.temporalCounter_i1 < 63) {
      SupervisorB2_DW.temporalCounter_i1++;
    }

    if (SupervisorB2_DW.is_active_c2_SupervisorB2 == 0) {
      SupervisorB2_DW.is_active_c2_SupervisorB2 = 1U;
      SupervisorB2_DW.is_c2_SupervisorB2 = Superviso_IN_Stato_Marcia_rover;
      SupervisorB2_updateSafetyLimits(rtb_rover_safety_state, &V_MAX, &OMEGA_MAX);
      SupervisorB2_DW.v_user = SupervisorB2_U.BLE.ay_norm * (real32_T)V_MAX;
      omega_user = SupervisorB2_U.BLE.bx_norm * (real32_T)OMEGA_MAX;
      if (SupervisorB2_DW.invert_y) {
        if (SupervisorB2_DW.v_user >= 0.0F) {
          SupervisorB2_DW.invert_y = false;
        } else {
          SupervisorB2_DW.v_user = -SupervisorB2_DW.v_user;
        }
      }

      SupervisorB2_DW.is_Stato_Marcia_rover = SupervisorB2_IN_Normale_marcia;

      /* Outport: '<Root>/current_action' incorporates:
       *  Inport: '<Root>/BLE'
       */
      SupervisorB2_Y.current_action = CMD_NORMAL;
      if (SupervisorB2_DW.v_user > 0.0F) {
        /* Outport: '<Root>/v_ref_actuation' */
        SupervisorB2_Y.v_ref_actuation = SupervisorB2_DW.v_user;

        /* Outport: '<Root>/omega_ref_actuation' */
        SupervisorB2_Y.omega_ref_actuation = omega_user;
      } else if (SupervisorB2_DW.v_user <= -0.5F) {
        SupervisorB2_DW.start180 = true;
      } else {
        /* Outport: '<Root>/v_ref_actuation' */
        SupervisorB2_Y.v_ref_actuation = 0.0F;

        /* Outport: '<Root>/omega_ref_actuation' */
        SupervisorB2_Y.omega_ref_actuation = omega_user;
      }
    } else if (SupervisorB2_DW.is_c2_SupervisorB2 ==
               IN_Procedura_frenata_di_emergen) {
      if ((rtb_rover_safety_state != SAFETY_CRITICAL) &&
          SupervisorB2_DW.estop_recover_enabled) {
        /* Outport: '<Root>/actuate_emergency_stop' */
        SupervisorB2_Y.actuate_emergency_stop = false;
        SupervisorB2_DW.is_Procedura_frenata_di_emergen =
          SupervisorB2_IN_NO_ACTIVE_CHILD;
        SupervisorB2_DW.is_c2_SupervisorB2 = Superviso_IN_Stato_Marcia_rover;
        SupervisorB2_updateSafetyLimits(SAFETY_DEGRADED, &V_MAX, &OMEGA_MAX);
        SupervisorB2_DW.v_user = SupervisorB2_U.BLE.ay_norm * (real32_T)V_MAX;
        omega_user = SupervisorB2_U.BLE.bx_norm * (real32_T)OMEGA_MAX;
        if (SupervisorB2_DW.invert_y) {
          if (SupervisorB2_DW.v_user >= 0.0F) {
            SupervisorB2_DW.invert_y = false;
          } else {
            SupervisorB2_DW.v_user = -SupervisorB2_DW.v_user;
          }
        }

        SupervisorB2_DW.is_Stato_Marcia_rover = SupervisorB2_IN_Normale_marcia;

        /* Outport: '<Root>/current_action' incorporates:
         *  Inport: '<Root>/BLE'
         */
        SupervisorB2_Y.current_action = CMD_NORMAL;
        if (SupervisorB2_DW.v_user > 0.0F) {
          /* Outport: '<Root>/v_ref_actuation' */
          SupervisorB2_Y.v_ref_actuation = SupervisorB2_DW.v_user;

          /* Outport: '<Root>/omega_ref_actuation' */
          SupervisorB2_Y.omega_ref_actuation = omega_user;
        } else if (SupervisorB2_DW.v_user <= -0.5F) {
          SupervisorB2_DW.start180 = true;
        } else {
          /* Outport: '<Root>/v_ref_actuation' */
          SupervisorB2_Y.v_ref_actuation = 0.0F;

          /* Outport: '<Root>/omega_ref_actuation' */
          SupervisorB2_Y.omega_ref_actuation = omega_user;
        }
      } else if (SupervisorB2_DW.is_Procedura_frenata_di_emergen ==
                 Supe_IN_In_frenata_di_emergenza) {
        /* Outport: '<Root>/current_action' */
        SupervisorB2_Y.current_action = CMD_ESTOP;
        guard1 = false;
        if ((rx_status == RX_CRITICAL) && (SupervisorB2_DW.temporalCounter_i1 >=
             50)) {
          guard1 = true;
        } else {
          if (!SupervisorB2_DW.roverIsStopped) {
            SupervisorB2_DW.durationCounter_1_j = 0U;
          }

          if (SupervisorB2_DW.durationCounter_1_j > 10U) {
            guard1 = true;
          } else {
            SupervisorB2_DW.roverIsStopped = SupervisorB2_checkStop
              (SupervisorB2_U.Board1_Data.payload.wheel_speed_rpm);
            if (!SupervisorB2_DW.roverIsStopped) {
              SupervisorB2_DW.durationCounter_1_j = 0U;
            }
          }
        }

        if (guard1) {
          SupervisorB2_DW.is_Procedura_frenata_di_emergen =
            SupervisorB2_IN_Motori_fermi;

          /* Outport: '<Root>/current_action' */
          SupervisorB2_Y.current_action = CMD_STOP;
          SupervisorB2_DW.estop_recover_enabled = true;
        }
      } else {
        /* Outport: '<Root>/current_action' */
        /* case IN_Motori_fermi: */
        SupervisorB2_Y.current_action = CMD_STOP;
      }

      /* case IN_Stato_Marcia_rover: */
    } else if (((SupervisorB2_B.B2Decision == CMD_ESTOP) &&
                (SupervisorB2_DW.v_user > 0.0F) &&
                (!SupervisorB2_DW.is_rotating180)) || (rtb_rover_safety_state ==
                SAFETY_CRITICAL)) {
      SupervisorB2_DW.estop_recover_enabled = false;
      if (SupervisorB2_DW.is_Stato_Marcia_rover ==
          SupervisorB2_IN_Retromarcia_180) {
        SupervisorB2_DW.is_rotating180 = false;
        SupervisorB2_DW.is_Stato_Marcia_rover = SupervisorB2_IN_NO_ACTIVE_CHILD;
      } else {
        SupervisorB2_DW.is_Stato_Marcia_rover = SupervisorB2_IN_NO_ACTIVE_CHILD;
      }

      SupervisorB2_DW.invert_y = false;
      SupervisorB2_DW.is_c2_SupervisorB2 = IN_Procedura_frenata_di_emergen;
      SupervisorB2_DW.durationCounter_1_j = 0U;
      SupervisorB2_DW.temporalCounter_i1 = 0U;
      SupervisorB2_DW.is_Procedura_frenata_di_emergen =
        Supe_IN_In_frenata_di_emergenza;

      /* Outport: '<Root>/current_action' */
      SupervisorB2_Y.current_action = CMD_ESTOP;

      /* Outport: '<Root>/v_ref_actuation' */
      SupervisorB2_Y.v_ref_actuation = 0.0F;

      /* Outport: '<Root>/omega_ref_actuation' */
      SupervisorB2_Y.omega_ref_actuation = 0.0F;

      /* Outport: '<Root>/actuate_emergency_stop' */
      SupervisorB2_Y.actuate_emergency_stop = true;
    } else {
      SupervisorB2_updateSafetyLimits(SAFETY_DEGRADED, &V_MAX, &OMEGA_MAX);
      SupervisorB2_DW.v_user = SupervisorB2_U.BLE.ay_norm * (real32_T)V_MAX;
      omega_user = SupervisorB2_U.BLE.bx_norm * (real32_T)OMEGA_MAX;
      if (SupervisorB2_DW.invert_y) {
        if (SupervisorB2_DW.v_user >= 0.0F) {
          SupervisorB2_DW.invert_y = false;
        } else {
          SupervisorB2_DW.v_user = -SupervisorB2_DW.v_user;
        }
      }

      if (SupervisorB2_DW.is_Stato_Marcia_rover ==
          SupervisorB2_IN_Normale_marcia) {
        /* Outport: '<Root>/current_action' */
        SupervisorB2_Y.current_action = CMD_NORMAL;
        if (SupervisorB2_DW.start180) {
          SupervisorB2_DW.start180 = false;
          SupervisorB2_DW.is_Stato_Marcia_rover =
            SupervisorB2_IN_Retromarcia_180;

          /* Outport: '<Root>/current_action' */
          SupervisorB2_Y.current_action = CMD_ROTATE_180;
          SupervisorB2_DW.is_rotating180 = true;
          SupervisorB2_DW.targetAngle = SupervisorB2_angleCalculator180
            (SupervisorB2_U.IMU.yaw);
          angle_err = SupervisorB2_angleError(SupervisorB2_U.IMU.yaw,
            SupervisorB2_DW.targetAngle);
          omega_user = fabsf(angle_err);
          if (omega_user < 7.5F) {
            SupervisorB2_DW.done180 = true;
          } else if (omega_user > 45.0F) {
            if (rtIsNaNF(-angle_err)) {
              omega_user = (rtNaNF);
            } else if (-angle_err < 0.0F) {
              omega_user = -1.0F;
            } else {
              omega_user = (real32_T)(-angle_err > 0.0F);
            }

            /* Outport: '<Root>/omega_ref_actuation' */
            SupervisorB2_Y.omega_ref_actuation = omega_user * (real32_T)
              OMEGA_MAX;
          } else {
            if (rtIsNaNF(-angle_err)) {
              angle_err = (rtNaNF);
            } else if (-angle_err < 0.0F) {
              angle_err = -1.0F;
            } else {
              angle_err = (real32_T)(-angle_err > 0.0F);
            }

            /* Outport: '<Root>/omega_ref_actuation' */
            SupervisorB2_Y.omega_ref_actuation = fminf((real32_T)OMEGA_MAX,
              fmaxf(omega_user, 15.0F) * 0.005F) * angle_err;
          }
        } else if (SupervisorB2_DW.v_user > 0.0F) {
          /* Outport: '<Root>/v_ref_actuation' */
          SupervisorB2_Y.v_ref_actuation = SupervisorB2_DW.v_user;

          /* Outport: '<Root>/omega_ref_actuation' */
          SupervisorB2_Y.omega_ref_actuation = omega_user;
        } else if (SupervisorB2_DW.v_user <= -0.5F) {
          SupervisorB2_DW.start180 = true;
        } else {
          /* Outport: '<Root>/v_ref_actuation' */
          SupervisorB2_Y.v_ref_actuation = 0.0F;

          /* Outport: '<Root>/omega_ref_actuation' */
          SupervisorB2_Y.omega_ref_actuation = omega_user;
        }
      } else {
        /* Outport: '<Root>/current_action' */
        /* case IN_Retromarcia_180: */
        SupervisorB2_Y.current_action = CMD_ROTATE_180;
        if (SupervisorB2_DW.done180) {
          SupervisorB2_DW.done180 = false;
          SupervisorB2_DW.invert_y = ((SupervisorB2_DW.v_user < 0.0F) ||
            SupervisorB2_DW.invert_y);
          SupervisorB2_DW.is_rotating180 = false;
          SupervisorB2_DW.is_Stato_Marcia_rover = SupervisorB2_IN_Normale_marcia;

          /* Outport: '<Root>/current_action' */
          SupervisorB2_Y.current_action = CMD_NORMAL;
          if (SupervisorB2_DW.v_user > 0.0F) {
            /* Outport: '<Root>/v_ref_actuation' */
            SupervisorB2_Y.v_ref_actuation = SupervisorB2_DW.v_user;

            /* Outport: '<Root>/omega_ref_actuation' */
            SupervisorB2_Y.omega_ref_actuation = omega_user;
          } else if (SupervisorB2_DW.v_user <= -0.5F) {
            SupervisorB2_DW.start180 = true;
          } else {
            /* Outport: '<Root>/v_ref_actuation' */
            SupervisorB2_Y.v_ref_actuation = 0.0F;

            /* Outport: '<Root>/omega_ref_actuation' */
            SupervisorB2_Y.omega_ref_actuation = omega_user;
          }
        } else {
          angle_err = SupervisorB2_angleError(SupervisorB2_U.IMU.yaw,
            SupervisorB2_DW.targetAngle);
          omega_user = fabsf(angle_err);
          if (omega_user < 7.5F) {
            SupervisorB2_DW.done180 = true;
          } else if (omega_user > 45.0F) {
            if (rtIsNaNF(-angle_err)) {
              omega_user = (rtNaNF);
            } else if (-angle_err < 0.0F) {
              omega_user = -1.0F;
            } else {
              omega_user = (real32_T)(-angle_err > 0.0F);
            }

            /* Outport: '<Root>/omega_ref_actuation' */
            SupervisorB2_Y.omega_ref_actuation = omega_user * (real32_T)
              OMEGA_MAX;
          } else {
            if (rtIsNaNF(-angle_err)) {
              angle_err = (rtNaNF);
            } else if (-angle_err < 0.0F) {
              angle_err = -1.0F;
            } else {
              angle_err = (real32_T)(-angle_err > 0.0F);
            }

            /* Outport: '<Root>/omega_ref_actuation' */
            SupervisorB2_Y.omega_ref_actuation = fminf((real32_T)OMEGA_MAX,
              fmaxf(omega_user, 15.0F) * 0.005F) * angle_err;
          }
        }
      }
    }

    if (SupervisorB2_DW.roverIsStopped) {
      SupervisorB2_DW.durationCounter_1_j++;
    } else {
      SupervisorB2_DW.durationCounter_1_j = 0U;
    }

    /* End of Chart: '<S5>/Check rover safety state1' */
  }

  /* End of Outputs for SubSystem: '<Root>/Generate speed ref for b1 fallback' */

  /* MATLAB Function: '<Root>/Board 1 fault masks1' incorporates:
   *  Inport: '<Root>/IMU'
   *  Inport: '<Root>/last_valid_b1_ms'
   */
  if (!SupervisorB2_DW.init_not_empty) {
    SupervisorB2_DW.last_enc_ms = SupervisorB2_U.last_valid_b1_ms;
    SupervisorB2_DW.last_imu_ms = SupervisorB2_U.IMU.data_last_valid_ms;
    SupervisorB2_DW.win_start_ms = SupervisorB2_U.IMU.data_last_valid_ms;
    SupervisorB2_DW.init_not_empty = true;
  }

  /* Outport: '<Root>/imu_coherence_status' incorporates:
   *  MATLAB Function: '<Root>/Board 1 fault masks1'
   */
  SupervisorB2_Y.imu_coherence_status = IMU_COHERENT;

  /* MATLAB Function: '<Root>/Board 1 fault masks1' incorporates:
   *  Inport: '<Root>/Board1_Data'
   *  Inport: '<Root>/IMU'
   *  Inport: '<Root>/last_valid_b1_ms'
   */
  if (SupervisorB2_U.last_valid_b1_ms != SupervisorB2_DW.last_enc_ms) {
    elapsedTicks = SupervisorB2_U.last_valid_b1_ms -
      /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
      /*MW:OvSatOk*/ SupervisorB2_DW.last_enc_ms;
    if (elapsedTicks > SupervisorB2_U.last_valid_b1_ms) {
      elapsedTicks = 0U;
    }

    V_MAX = (real_T)elapsedTicks * 0.001;
    SupervisorB2_DW.last_enc_ms = SupervisorB2_U.last_valid_b1_ms;
    if ((V_MAX > 0.0) && (V_MAX < 0.1)) {
      SupervisorB2_DW.acc_dtheta_enc +=
        ((SupervisorB2_U.Board1_Data.payload.wheel_speed_rpm[0] +
          SupervisorB2_U.Board1_Data.payload.wheel_speed_rpm[2]) * 0.5F -
         (SupervisorB2_U.Board1_Data.payload.wheel_speed_rpm[1] +
          SupervisorB2_U.Board1_Data.payload.wheel_speed_rpm[3]) * 0.5F) *
        0.019290481206253117 * V_MAX;
    }
  }

  if (SupervisorB2_U.IMU.data_last_valid_ms != SupervisorB2_DW.last_imu_ms) {
    elapsedTicks = SupervisorB2_U.IMU.data_last_valid_ms -
      /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
      /*MW:OvSatOk*/ SupervisorB2_DW.last_imu_ms;
    if (elapsedTicks > SupervisorB2_U.IMU.data_last_valid_ms) {
      elapsedTicks = 0U;
    }

    V_MAX = (real_T)elapsedTicks * 0.001;
    SupervisorB2_DW.last_imu_ms = SupervisorB2_U.IMU.data_last_valid_ms;
    if ((V_MAX > 0.0) && (V_MAX < 0.1)) {
      SupervisorB2_DW.acc_dtheta_imu += SupervisorB2_U.IMU.gz_dps *
        3.1415926535897931 / 180.0 * V_MAX;
    }
  }

  V_MAX = SupervisorB2_DW.acc_dtheta_imu;
  OMEGA_MAX = SupervisorB2_DW.acc_dtheta_enc;
  elapsedTicks = SupervisorB2_U.IMU.data_last_valid_ms -
    /*MW:operator MISRA2012:D4.1 CERT-C:INT30-C 'Justifying MISRA C rule violation'*/
    /*MW:OvSatOk*/ SupervisorB2_DW.win_start_ms;
  if (elapsedTicks > SupervisorB2_U.IMU.data_last_valid_ms) {
    elapsedTicks = 0U;
  }

  if (elapsedTicks >= 250U) {
    if ((fabs(SupervisorB2_DW.acc_dtheta_imu) > 0.087266462599716474) && (fabs
         (SupervisorB2_DW.acc_dtheta_enc) > 0.087266462599716474)) {
      err = SupervisorB2_DW.acc_dtheta_imu - SupervisorB2_DW.acc_dtheta_enc;
      if (fabs(err) > 0.13962634015954636) {
        if (SupervisorB2_DW.fault_cnt > 2147483646) {
          SupervisorB2_DW.fault_cnt = MAX_int32_T;
        } else {
          SupervisorB2_DW.fault_cnt++;
        }

        if (SupervisorB2_DW.fault_cnt > 1) {
          SupervisorB2_DW.fault_cnt = 1;
        }
      } else {
        if (SupervisorB2_DW.fault_cnt < -2147483647) {
          SupervisorB2_DW.fault_cnt = MIN_int32_T;
        } else {
          SupervisorB2_DW.fault_cnt--;
        }

        if (SupervisorB2_DW.fault_cnt < 0) {
          SupervisorB2_DW.fault_cnt = 0;
        }
      }

      if (SupervisorB2_DW.fault_cnt >= 1) {
        if (err > 0.0) {
          /* Outport: '<Root>/imu_coherence_status' */
          SupervisorB2_Y.imu_coherence_status = IMU_INCOHERENT_RIGHT;
        } else {
          /* Outport: '<Root>/imu_coherence_status' */
          SupervisorB2_Y.imu_coherence_status = IMU_INCOHERENT_LEFT;
        }
      }
    } else {
      if (SupervisorB2_DW.fault_cnt < -2147483647) {
        SupervisorB2_DW.fault_cnt = MIN_int32_T;
      } else {
        SupervisorB2_DW.fault_cnt--;
      }

      if (SupervisorB2_DW.fault_cnt < 0) {
        SupervisorB2_DW.fault_cnt = 0;
      }
    }

    SupervisorB2_DW.acc_dtheta_enc = 0.0;
    SupervisorB2_DW.acc_dtheta_imu = 0.0;
    SupervisorB2_DW.win_start_ms = SupervisorB2_U.IMU.data_last_valid_ms;
  }

  /* Outport: '<Root>/real' incorporates:
   *  DataTypeConversion: '<Root>/Data Type Conversion'
   */
  SupervisorB2_Y.real = (real32_T)V_MAX;

  /* Outport: '<Root>/expected' incorporates:
   *  DataTypeConversion: '<Root>/Data Type Conversion1'
   */
  SupervisorB2_Y.expected = (real32_T)OMEGA_MAX;

  /* Update absolute time for base rate */
  /* The "clockTick0" counts the number of times the code of this task has
   * been executed. The resolution of this integer timer is 0.02, which is the step size
   * of the task. Size of "clockTick0" ensures timer will not overflow during the
   * application lifespan selected.
   */
  SupervisorB2_M->Timing.clockTick0++;
}

/* Model initialize function */
void SupervisorB2_initialize(void)
{
  /* Enable for Chart: '<Root>/Generate Decision for B1' incorporates:
   *  SubSystem: '<S4>/superB2_DEGB1_0'
   */
  /* Enable for Chart: '<S9>/SuperB2_DEGB1_0' */
  SupervisorB2_DW.previousTicks = SupervisorB2_M->Timing.clockTick0;
}

/* Model terminate function */
void SupervisorB2_terminate(void)
{
  /* (no terminate code required) */
}

/*
 * File trailer for generated code.
 *
 * [EOF]
 */
