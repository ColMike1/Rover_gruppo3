/*
 * led_task.c
 *
 *  Created on: Jan 26, 2026
 *      Author: OEM
 */

#include "led/led_task.h"
#include "snapshot/supervisor_snapshot.h"
#include "snapshot/encoder_snapshot.h"
#include "cmsis_os2.h"
#include "string.h"
#include "gpio.h"
#include "snapshot/rx_snapshot.h"

void Led_TaskStep(){
	float rpm[4];
	float av_rpm = 0;
	EncoderSnapshot_t enc;

	//EncoderSnapshot_Read(&enc);
	//memcpy(rpm, enc.wheel_speed_rpm, sizeof(rpm));
	//av_rpm = (rpm[0] + rpm[1] + rpm[2] + rpm[3])/4.0f;

	static SupervisorSnapshot_t sup;
	static RxSnapshot_t rx;
	SupervisorSnapshot_Read(&sup);

	RxSnapshot_Read(&rx);

	if(sup.critical_mask != 0 || rx.payload.critical_mask != 0)
		HAL_GPIO_WritePin(GPIOB, RED_LED_Pin, GPIO_PIN_SET);
	else
		HAL_GPIO_WritePin(GPIOB, RED_LED_Pin, GPIO_PIN_RESET);


	if(sup.current_action == CMD_GO_LEFT){
		//accendi led a sinistra
	}
	else{
		//spegni led a sinistra
	}


	if(sup.current_action == CMD_GO_RIGHT){
		//accendi led a destra

	}
	else{
		//spegni led a destra
	}

	if(sup.current_action == CMD_ESTOP){
		//accendi led blu
	}
	else{
		//spegni led blu
	}

	/*
	if(sup.degraded_mask != 0 || rx.payload.degraded_mask!=0)
		HAL_GPIO_WritePin(GPIOB, YELLOW_LED_Pin, GPIO_PIN_SET);
	else
		HAL_GPIO_WritePin(GPIOB, YELLOW_LED_Pin, GPIO_PIN_RESET);
		*/
}
