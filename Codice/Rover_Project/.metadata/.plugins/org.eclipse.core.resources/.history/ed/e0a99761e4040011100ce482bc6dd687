/*
 * rx_snapshot.h
 *
 *  Created on: Jan 18, 2026
 *      Author: Sterm
 */

#ifndef INC_SNAPSHOT_RX_SNAPSHOT_H_
#define INC_SNAPSHOT_RX_SNAPSHOT_H_

#include <stdint.h>
#include "cmsis_os.h"
#include "shared_resources/comm_message_structures.h"
#include "shared_resources/comm_status.h"


/* ===== Snapshot ===== */
typedef struct
{
    /* Payload ricevuto (raw, applicativo) */
    CommPayloadB2_t payload;

    /* Status dell'ultimo evento RX osservato */
    CommUnpackStatus_t last_event;

    uint32_t task_last_run_ms;     /* ultima esecuzione del task */
    uint32_t data_last_valid_ms;  /* ultimo istante in cui i dati sono validi */

} RxSnapshot_t;


void RxSnapshot_MutexInit(osMutexId_t mutex_handle);

/* ===== Writer (RX task only) ===== */
void RxSnapshot_Write(const RxSnapshot_t *src);

/* ===== Reader (Supervisor / others) ===== */
void RxSnapshot_Read(RxSnapshot_t *dst);


#endif /* INC_SNAPSHOT_RX_SNAPSHOT_H_ */
