/*
 * supervisor_snapshot.h
 *
 *  Created on: Jan 11, 2026
 *      Author: Sterm
 */

#ifndef INC_SNAPSHOT_SUPERVISOR_SNAPSHOT_H_
#define INC_SNAPSHOT_SUPERVISOR_SNAPSHOT_H_

#include <stdint.h>
#include "shared_resources/board1_faults.h"
#ifndef MATLAB_MEX_FILE
  #include "cmsis_os.h"
#endif
/* ===== Snapshot Supervisore Board 1 ===== */
typedef struct
{
	/* Timestamp decisione */
	uint32_t task_last_run_ms;

  /* Fault di board 1 presenti che comportano uno stato degradato*/
  uint32_t degraded_mask;

  /* Fault di board 1 presenti che comportano uno stato di emergenza*/
  uint32_t critical_mask;


  /* Comandi AUTORIZZATI */
  float speed_ref_rpm;     /* velocit√† longitudinale */
  float steering_cmd;      /* comando sterzata */

  /* Heartbeat / alive counter */
  uint8_t alive_counter;

} SupervisorSnapshot_t;



/* ================= API ================= */

#ifndef MATLAB_MEX_FILE
void SupervisorSnapshot_MutexInit(osMutexId_t mutex_handle);
#endif

/* Writer: SOLO supervision task (Board 1) */
void SupervisorSnapshot_Write(const SupervisorSnapshot_t *src);

/* Reader: Control, Actuation, TX */
void SupervisorSnapshot_Read(SupervisorSnapshot_t *dst);


#endif /* INC_SNAPSHOT_SUPERVISOR_SNAPSHOT_H_ */
